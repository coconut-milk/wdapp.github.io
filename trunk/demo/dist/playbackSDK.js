!function(a){var i={};function s(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=a,s.c=i,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([,function(e,t){!function(S,k,D){function t(e){this.isReady=!1,this.isPublishing=0,this.id=e.callbackPlayer.id;var t={userid:e.userId,videoid:e.videoId,recordid:e.recordId,isShowBar:e.isShowBar,upid:e.upId,viewerid:e.viewerId,roomid:e.roomId,ua:"1"},a={allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"};this.flashPlayerInit=function(){if(swfobject.embedSWF("//player.csslcloud.net/platform/live/CallbackPlayer.swf",e.callbackPlayer.id,e.callbackPlayer.width,e.callbackPlayer.height,"10.0.0","/flash/expressInstall.swf",t,a),"isMobile"!=A.isMobile())new ReportLog(e,0,1,null,!1)},x.isH5play||this.flashPlayerInit(),this.getFlash=function(){return swfobject.getObjectById(this.id)},this.playbackRate=function(e){if(x.isH5play||"isMobile"===A.isMobile()){e=parseFloat(e);this.getH5player().playbackRate=e}},this.seek=function(e){if(!(e<0))if(x.isH5play||"isMobile"==A.isMobile())this.getH5player().currentTime=e;else{var t=this.getFlash();if(!t)return;t.seek(e)}},this.getFlash=function(){return swfobject.getObjectById(this.id)},this.getH5player=function(){return S("#playbackVideo")[0]},this.getPlayerTime=function(){return this.isReady?(e=x.isH5play||"isMobile"==A.isMobile()?this.getH5player().currentTime:parseInt(this.getFlash().getPosition(),10),isNaN(e)||e<0?0:e):0;var e},this.getDuration=function(){if(x.isH5play||"isMobile"==A.isMobile())return this.getH5player().duration;var e=this.getFlash();return e?e.getDuration():void 0},this.getBuffer=function(){if(x.isH5play||"isMobile"==A.isMobile()){if(!this.getH5player()||!this.getH5player().buffered||!this.getH5player().buffered.end(0))return 0;for(var e=0,t=this.getH5player().buffered,a=0;a<t.length;a++)e+=t.end(a)-t.start(a);return e}var i=this.getFlash();if(i)return i.getBufferLength()},this.setVolume=function(e){if(!x.isH5play&&"isMobile"!=A.isMobile()){var t=this.getFlash();if(!t)return;return t.setVolume(e)}this.getH5player().volume=parseFloat(e)},this.getVolume=function(){if(x.isH5play||"isMobile"==A.isMobile())return this.getH5player().volume;var e=this.getFlash();return e?e.getVolume():void 0},this.play=function(){if(!x.isH5play&&"isMobile"!=A.isMobile()){var e=this.getFlash();if(!e)return;return e.isPlay()}A.pauseState?this.getH5player().play():this.getH5player().pause()},this.setZScale=function(e){var t=this.getFlash();if(t)return t.setZScale(e)},this.getZScale=function(){var e=this.getFlash();if(e)return e.getZScale()},this.setScale=function(e){var t=this.getFlash();if(t)return t.setScale(e)},this.getScale=function(){var e=this.getFlash();if(e)return e.getScale()},this.openSettingPanel=function(){var e=this.getFlash();if(e)return e.openSettingPanel()}}function R(e){var t="https:"===k.location.protocol,a=e.chat.host;if(t&&a&&a.indexOf(":")){var i=a.split(":");if(2==i.length){var s=parseInt(i[1]);if(!isNaN(s)){var r=s+400;a=i[0]+":"+r}}}var n=0;if("isMobile"==A.isMobile()&&(n=1),x.forceNew){io.connect(D.location.protocol+"//"+a+"/replay?roomid="+e.roomId+"&sessionid="+e.viewer.sessionId+"&platform=1&terminal="+n,{forceNew:!0});g.log("{forceNew: true}")}else{io.connect(D.location.protocol+"//"+a+"/replay",{query:{roomid:e.roomId,sessionid:e.viewer.sessionId,platform:1,terminal:n}});g.log("{forceNew: false}")}}function a(e,t){this.isReady=!1,C.fastMode||swfobject.embedSWF("//zeus.csslcloud.net/flash/Player.swf",e.drawPanel.id,e.drawPanel.width,e.drawPanel.height,"10.0.0","/flash/expressInstall.swf",{type:"drawpanel"},{allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"},{}),this.getFlash=function(){if(this.isReady)return swfobject.getObjectById(e.drawPanel.id)},this.clear=function(){C.clear();var e=this.getFlash();e&&e.clear()},this.draw=function(e){C.draw(e);var t=this.getFlash();t&&t.draw(e)},this.draws=function(e){var t,a=this.getFlash();a&&(t=e,setTimeout(function(){a.drawList(t)}))},this.filp=function(e){C.pageChange(e);var t=this.getFlash();if(t){var a=JSON.parse(e),i=a.url;"https:"===k.location.protocol&&(a.url=i.replace(/http:/g,"https:")),m.adapt?t.filp(JSON.stringify(a),"auto"):t.filp(JSON.stringify(a))}},this.animation=function(e){C.animationChange(e);var t=this.getFlash();t&&t.animation(e)},this.intervalNum=0,this.interval=function(){var e=0;try{e=M.callbackPlayer.getPlayerTime()}catch(n){}if(!(e<0)){d&&(c=e,2.5<=Math.abs(c-o)&&seekComplete&&seekComplete(),o=e),M.isRequestDraws&&M.drawsInfoRequestPool.isHttpRequestCurrentDraws(e,function(e){M.draws=e});try{if(M.animations&&0<M.animations.length)if(M.animationIndex<M.animations.length)if(0<=(s=M.pageChangeIndex)){var t=M.pageChanges[s],a=M.animations[M.animationIndex+1];t&&a&&t.encryptDocId==a.encryptDocId&&e>=a.time&&t.time<=a.time&&(C.fastMode?this.animation(a):this.animation(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,step:a.step})),M.animationIndex=M.animationIndex+1)}}catch(n){}try{if(M.pageChanges&&0<M.pageChanges.length)if(M.pageChangeIndex<M.pageChanges.length)if(e>=(t=M.pageChanges[M.pageChangeIndex+1]).time){"function"==typeof k.on_cc_callback_page_change&&k.on_cc_callback_page_change(t),"function"==typeof k.on_cc_request_snapshoot&&k.on_cc_request_snapshoot(t),C.fastMode?this.filp(t):this.filp(JSON.stringify({fileName:t.docName,totalPage:t.docTotalPage,docid:t.encryptDocId,url:t.url,page:t.pageNum,useSDK:t.useSDK})),M.pageChangeIndex=M.pageChangeIndex+1;var i={};i.docId=t.docId,i.docName=t.docName,i.docTotalPage=t.docTotalPage,i.pageNum=t.pageNum,"function"==typeof k.on_cc_callback_pagechange&&k.on_cc_callback_pagechange(i)}}catch(n){}try{var s;if(M.animations&&0<M.animations.length)if(M.animationIndex<M.animations.length)if(0<=(s=M.pageChangeIndex)){t=M.pageChanges[s],a=M.animations[M.animationIndex+1];t&&a&&t.encryptDocId==a.encryptDocId&&e>=a.time&&t.time<=a.time&&(C.fastMode?this.animation(a):this.animation(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,step:a.step})),M.animationIndex=M.animationIndex+1)}}catch(n){}try{if(M.draws&&0<M.draws.length&&M.drawIndex<M.draws.length)for(var r=M.draws[M.drawIndex+1];e>=r.time;)C.fastMode?this.draw(r):this.draw(r.data),M.drawIndex=M.drawIndex+1,r=M.draws[M.drawIndex+1]}catch(n){}}},this.intervalPainting=function(e){e.drawPanel.intervalNum=setInterval(function(){e.drawPanel.interval(e)},1e3)}}function h(i){S.ajax({url:i.url,type:"GET",data:i.data,tryCount:0,retryLimit:3,timeout:5e3,dataType:"jsonp",success:function(e){i.done(e)},error:function(e,t,a){if("timeout"==t)return this.tryCount++,this.tryCount<this.retryLimit?void S.ajax(this):void("function"==typeof i.fn&&i.fn(t));e.status}})}var f=function(){this.requestState=!1,this.result=0,this.startTime=0,this.endTime=0,this.key=0,this.index=0,this.ajax={},this.states=[],this.snapshoot=[],this.drawsAlready=0,this.roomId=m.roomId,this.userId=m.userId,this.recordId=m.recordId,this.liveId=m.liveId,this.drawRequestTime=m.drawRequestTime,this.setSnapshoot=function(e,t){this.snapshoot[e]=t},this.getSnapshoot=function(){return this.snapshoot},this.init=function(e){for(var t=0;t<this.drawRequestTime;t++){var a={requestState:!1,result:0,startTime:e.startTime,endTime:e.endTime,key:t};e.startTime=e.startTime+e.blockTime,e.endTime=e.startTime+e.blockTime,this.setState(a)}},this.httpRequest=function(e,t){var i=this;i.requestState=!0,this.ajax=S.ajax({url:e.url,type:"GET",data:e.param,tryCount:0,retryLimit:3,timeout:k.TIMEOUT,dataType:"jsonp",success:function(e){(i.result=e).success?(t(e),i.requestState=!1):g.log("data.success",e.success)},error:function(e,t,a){if("timeout"==t)return this.tryCount++,this.tryCount<this.retryLimit?(S.ajax(this),void g.log("ajax["+i.key+"] try again tryCount",this.tryCount)):(g.log("数据请求失败且重试多次"),void(i.requestState=!1));e.status}})},this.abort=function(){this.ajax.abort(),this.requestState=!1},this.setState=function(e){if("object"==typeof e){var t=e.key||this.index++;e.key&&!isNaN(e.key)&&(this.index=parseInt(e.key)+1);var a=new f;a.requestState=e.requestState||this.requestState,a.result=e.result||this.result,a.startTime=e.startTime||this.startTime,a.endTime=e.endTime||this.endTime,a.ajax=e.ajax||this.ajax,a.snapshoot=e.snapshoot||this.snapshoot,a.key=t,this.states[t]=a}},this.getState=function(e){return this.states[e]},this.getStates=function(){return this.states},this.getCurrentStateIndex=function(e){for(var t=0,a=0;a<this.states.length;a++)if(e>this.states[a].startTime&&e<=this.states[a].endTime){t=a;break}return t},this.isDrawsAlready=function(){return parseInt(this.drawRequestTime,10)===parseInt(this.drawsAlready,10)}},p=function(d,u){function h(e,t){var a=e.concat(t),i=[],s={};for(var r in a)s[JSON.stringify(a[r])]||(i.push(a[r]),s[JSON.stringify(a[r])]=1);return i}this.state=d,this.requestNumber=2,this.httpRequestPool=[],this.draws=[],this.preState={},this.isHttpRequestCurrentDraws=function(e,t){if(d.drawRequestTime){var a=d.isDrawsAlready();if(a)g.log("画笔数据加载完毕，不在预加载某一段数据");else{var i=d.getStates(),s=d.getCurrentStateIndex(e),r=i[s];if(this.preState!=r&&this.preState.requestState&&(g.log("发现新的预加载请求，中断上一个预加载请求;index="+this.preState.key),this.preState.abort()),this.preState=r,a||r.result||r.requestState)g.log("预加载过这段数据或已有数据;index="+s);else{g.log("预加载数据",s);var n={index:s,states:i};this.httpRequestCurrentDraws(n,t)}}}},this.httpRequestCurrentDraws=function(e,a){var i=this,t=e.states,s=e.index,r=t[s],n={url:"//view.csslcloud.net/api/view/replay/v2/draw/range",param:{starttime:r.startTime,endtime:r.endTime,userid:r.userId,recordid:r.recordId,liveid:r.liveId}};r.httpRequest(n,function(e){var t=e.datas.meta.draw;g.log("*** 预加载成功 callback.draws["+s+"] ***",t),i.draws=h(i.draws,t),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),a(i.draws),M.state.drawsAlready++})},this.httpRequestStream=function(s){var r=this;if(r.state.isDrawsAlready())return g.log("httpRequestStream draws already",r.draws),g.log("callback.state",M.state),void g.log("snapshoot",u);for(var e=r.state.getStates(),t=0;t<e.length;t++){if(!(i=e[t]).result&&!i.requestState){if(!(r.httpRequestPool.length<r.requestNumber))break;r.httpRequestPool.push(i)}}for(var a=0;a<r.httpRequestPool.length;a++){var i;(i=r.httpRequestPool[a]).result||i.requestState||function(i){var e={url:"//view.csslcloud.net/api/view/replay/v2/draw/range",param:{starttime:i.startTime,endtime:i.endTime,userid:i.userId,recordid:i.recordId,liveid:i.liveId}};i.httpRequest(e,function(e){var t=e.datas.meta.draw;g.log("请求流 draw["+i.key+"]",t),M.isRequestDraws?r.draws=h(r.draws,t):r.draws=r.draws.concat(t),r.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),s(r.draws);for(var a=0;a<r.httpRequestPool.length;a++)if(r.httpRequestPool[a].key==i.key){r.httpRequestPool.splice(a,1);break}M.state.drawsAlready++,r.httpRequestStream(s)})}(i)}},this.httpRequestSnapshoot=function(a,e,i){var s=this;if(d.isDrawsAlready())g.log("画笔数据请求完整，不在请求快照数据");else{var t=d.getStates(),r=(e=e,d.getCurrentStateIndex(e)),n=t[r];if(n){var o=u.getSnapshoot(),l=o[a.docId+"_"+a.pageNum+"_"+a.url];if(n.result||l)g.log("当前时间段存在数据或存在快照",r+"");else{g.log("_snapshoot.getSnapshoot()",o),u.requestState&&u.abort();var c={url:"//view.csslcloud.net/api/view/replay/v2/draw/snapshot",param:{docid:a.docId,currentpage:a.pageNum,userid:u.userId,recordid:u.recordId}};u.httpRequest(c,function(e){if(u.setSnapshoot(a.docId+"_"+a.pageNum+"_"+a.url,e),n.result)g.log("快照请求成功，当前时间段数据存在，丢弃快照"+r);else{M.isRequestDraws=!0;var t=e.datas.meta.draw;g.log("*** 快照 callback.draws["+a.docId+"_"+a.pageNum+"_"+a.url+"] ***",t),s.draws=h(s.draws,t),s.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),i(s.draws)}})}}}}};k.ListenerDuration=function(){if(on_cc_limit_request_draws){var e=setInterval(function(){parseInt(M.callbackPlayer.getDuration())&&(g.log("ListenerDuration"),on_cc_limit_request_draws&&on_cc_limit_request_draws(),clearInterval(e))},50);k.ListenerDuration=null}},k.on_cc_limit_request_draws=function(){if(m.drawRequestTime){g.log("分页请求画笔数据",m.drawRequestTime);var e=M.callbackPlayer.getDuration()+1;g.log("duration",e+"");var t=Math.ceil(e/m.drawRequestTime),a={blockTime:t,startTime:0,endTime:0+t};M.state.init(a),g.log("callback.state",M.state),M.drawsInfoRequestPool.httpRequestStream(function(e){M.draws=e,M.isHistoryReady=!0,M.drawPanel.isReady=!0}),setTimeout(function(){N()},1500),k.on_cc_limit_request_draws=null}},k.on_cc_request_snapshoot=function(e){if(m.drawRequestTime){g.log("pageChange",e);var t=M.callbackPlayer.getPlayerTime();M.drawsInfoRequestPool.httpRequestSnapshoot(e,t,function(e){M.draws=e,M.isHistoryReady=!0,M.drawPanel.isReady=!0})}};function i(b,P){!function(e,t){var o={roomid:e.roomId,userid:e.userId,liveid:e.liveId,upid:e.upId,groupid:e.groupId,recordid:e.recordId,viewertoken:e.viewertoken,viewername:e.viewername,forcibly:e.forcibly},l={globalData:{},requestLoginData:!1,requestInfoData:!1,requestDrawData:!1,requestChatqaData:!1,allRequests:0};o.version="3.0.3",o.service=3,o.client=4,h({url:"//view.csslcloud.net/api/room/replay/login",data:o,fn:k.on_cc_login_error,done:function(e){if(!c(e,k.on_cc_login_error))return!1;if(e.success){m.drawRequestTime=parseInt(e.datas.drawRequestTime)||1,k.TIMEOUT=k.TIMEOUT+1e3*m.drawRequestTime,C.fastMode||(m.drawRequestTime=""),g.log("options",m),M.state=new f;var t=new f;M.drawsInfoRequestPool=new p(M.state,t)}if(d(l.globalData,e),l.requestLoginData=!0,l.requestInfoData=!1,l.requestDrawData=!1,l.requestChatqaData=!1,l.allRequests++,u(l),"function"==typeof k.on_cc_login_success){var a=e.datas,i={type:a.template.type,desc:a.template.desc,name:a.template.name},s={name:a.viewer.name,id:a.viewer.id,groupId:a.viewer.groupId},r={desc:a.room.desc,liveStartTime:a.room.liveStartTime,name:a.room.name,documentDisplayMode:a.room.documentDisplayMode,barrage:a.room.barrage},n={startTime:a.live.endTime,endTime:a.live.endTime};k.on_cc_login_success({template:i,viewer:s,room:r,live:n})}m.drawRequestTime||h({url:"//view.csslcloud.net/api/view/replay/draw/info",data:o,fn:k.on_cc_request_draw_error,done:function(e){if(!c(e))return!1;d(l.globalData,e),l.requestLoginData=!1,l.requestInfoData=!1,l.requestDrawData=!0,l.requestChatqaData=!1,l.allRequests++,u(l)}}),h({url:"//view.csslcloud.net/api/view/replay/v2/chatqa/info",data:o,fn:k.on_cc_request_chatqa_error,done:function(e){if(!c(e,k.on_cc_request_chatqa_error))return!1;d(l.globalData,e),l.requestLoginData=!1,l.requestInfoData=!1,l.requestDrawData=!1,l.requestChatqaData=!0,l.allRequests++,u(l)}}),h({url:"//view.csslcloud.net/api/view/replay/v2/info",data:o,fn:k.on_cc_request_info_error,done:function(e){if(!c(e,k.on_cc_request_info_error))return!1;d(l.globalData,e),l.requestLoginData=!1,l.requestInfoData=!0,l.requestDrawData=!1,l.requestChatqaData=!1,l.allRequests++,u(l)}})}});var c=function(e,t){return e.success?!!e.datas:("function"==typeof t&&t(e),!1)},d=function(e,t){a(e,t),e.datas.meta||(e.datas.meta={}),a(e.datas.meta,t.datas.meta)},a=function(e,t){for(var a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(e[a]=t[a])},u=function(e){t(e)}}(b,function T(e){var t=e.globalData;if(e.requestLoginData){var a=D.getElementById("playbackPanel");if(C.fastMode&&a){S("#documentDisplayMode").val(t.datas.room.documentDisplayMode);var i=D.createElement("script");i.src="//image.csslcloud.net/js/dpc.js?v="+Math.floor(1e4*Math.random()),i.onload=function(){C.appendDrawPanel(),C.init(),C.isDPReady=!0,k.on_hdLive_drawPanel_complete&&k.on_hdLive_drawPanel_complete()},D.body.appendChild(i)}b.chat={host:t.datas.pusherNode.primary},b.viewer.sessionId=t.datas.sessionId,b.liveId=t.datas.encryptLiveId,b.upId=t.datas.upId,b.viewerId=t.datas.viewer.id,P.socket=new R(b),S.DW.groupId=t.datas.viewer.groupId,"function"==typeof k.on_cc_callback_player&&k.on_cc_callback_player(t.datas),b.recordId||(b.recordId=t.datas.encryptRecordId),x.isH5play?A.init(b):"isMobile"==A.isMobile()&&A.init(b)}var s=t.datas.meta;if(!s)return;if(e.requestInfoData){var r=s.pageChange;if(r){for(var n=0;n<r.length;n++){var o=r[n].url,l="https:"===k.location.protocol;0<o.indexOf("//")&&l&&(o=o.replace("http:","https:"),r[n].url=o)}"function"==typeof k.on_cc_callback_pages&&k.on_cc_callback_pages(r)}var c=s.pageChange;c&&c.length&&(c.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),P.pageChanges=c),P.pageChanges&&P.pageChanges.length&&P.drawPanel.filp(P.pageChanges[0]);var d=s.animation;d&&d.length&&(d.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),P.animations=d);var u=s.broadcast;if(k.chatLogs=s.broadcast,u&&u.length){u.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var n=0;n<u.length;n++){var h=u[n];"function"==typeof k.on_cc_live_broadcast_msg&&k.on_cc_live_broadcast_msg({content:h.content,time:h.time})}P.broadcasts=u}}if(e.requestChatqaData){var f=s.question;if(f&&f.length){f.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),P.questions=f;for(var n=0;n<P.questions.length;n++){var p=f[n];"function"==typeof k.on_cc_live_qa_question&&k.on_cc_live_qa_question({action:"question",value:{id:p.encryptId,content:p.content,groupId:p.groupId,userId:p.questionUserId,userName:p.questionUserName,userAvatar:p.questionUserAvatar,isPublish:p.isPublish}})}}var g=s.answer;if(g&&g.length){g.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),P.answers=g;for(var n=0;n<P.answers.length;n++){var m=g[n];"function"==typeof k.on_cc_live_qa_answer&&k.on_cc_live_qa_answer({action:"answer",value:{questionId:m.encryptId,content:m.content,userId:m.answerUserId,isPrivate:m.isPrivate,groupId:m.groupId,userName:m.answerUserName,userAvatar:m.answerUserAvatar,userRole:m.answerUserRole}})}}var v=s.chatLog;if(k.chatLogs=s.chatLog,v&&v.length){v.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var n=0;n<v.length;n++){var y=v[n];"function"==typeof k.on_cc_live_chat_msg&&k.on_cc_live_chat_msg({userid:y.userId,username:y.userName,time:y.time,msg:y.content,groupId:y.groupId,chatId:y.chatId,status:y.status,useravatar:y.userAvatar,userRole:y.userRole,usercustommark:y.userCustomMark,role:y.role})}P.chatLogs=v}k.chatLogs&&k.chatLogs.length&&(k.CHATLOGS=k.chatLogs,function w(){setInterval(function(){var e=0;try{e=parseInt(S("#playbackVideo")[0].currentTime,10)}catch(i){}if(!(e<=0)&&k.CHATLOGS.length)for(var t=k.CHATLOGS[0];t.time<=e;){var a=k.CHATLOGS.shift();if(M.chatMessageCache.push({userid:a.userId,username:a.userName,time:a.time,msg:a.content,groupId:a.groupId,useravatar:a.userAvatar,userRole:a.userRole,chatId:t.chatId,status:t.status,usercustommark:a.userCustomMark,role:a.role}),!k.CHATLOGS.length)break;t=k.CHATLOGS[0]}},1e3)}()),k.broadcasts&&k.broadcasts.length&&(k.BROADCASTS=k.broadcasts,function I(){setInterval(function(){var e=0;try{e=parseInt(S("#playbackVideo")[0].currentTime,10)}catch(i){}if(!(e<=0)&&k.BROADCASTS.length)for(var t=k.BROADCASTS[0];t.time<=e;){var a=k.BROADCASTS.shift();if(M.broadcastCache.push({content:a.content,time:a.time}),!k.BROADCASTS.length)break;t=k.BROADCASTS[0]}},1e3)}())}if(e.requestDrawData){var _=s.draw;_&&_.length&&(P.draws=_),P.isHistoryReady=!0,P.drawPanel.isReady=!0,setTimeout(function(){N()},1500)}k.on_cc_h5_player_load=function(){if(P.callbackPlayer.isReady=!0,!q){q=!0;var e=D.getElementById("drawPanel");e&&S.Callback.config({playerId:"playbackVideo"},s)}}});var q=!1}function s(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){M.broadcastCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],t=Math.min(this.cache.length,10),a=0;a<t;a++)e.push(this.cache.shift());"function"==typeof k.on_cc_live_broadcast_msg_sync&&k.on_cc_live_broadcast_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){M.broadcastCache.refresh()},80)}}}function r(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){M.chatMessageCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],t=Math.min(this.cache.length,10),a=0;a<t;a++)e.push(this.cache.shift());"function"==typeof k.on_cc_live_chat_msg_sync&&k.on_cc_live_chat_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){M.chatMessageCache.refresh()},80)}}}function n(e){this.chatLogs=[],this.broadcasts=[],this.draws=[],this.pageChanges=[],this.isHistoryReady=!1,this.questions=[],this.answers=[],this.pageChanges=[],this.draws=[],this.animations=[],this.pageChangeIndex=-1,this.drawIndex=-1,this.animationIndex=-1,this.isRequestDraws=!1,this.drawPanel=new a(e,this),this.history=new i(e,this),this.chatMessageCache=new r,this.broadcastCache=new s}var M={};k.isDebug=!1;var g={isDebug:k.isDebug,log:function(e,t){k.isDebug&&k.console&&"function"==typeof console.log&&(t?console.log(e+" => ",t):console.log(e))},isIE:function(){return-1<navigator.userAgent.indexOf("compatible")&&-1<navigator.userAgent.indexOf("MSIE")?(-1<navigator.userAgent.indexOf("MSIE 9.0")||navigator.userAgent.indexOf("MSIE 10.0"),!0):-1<navigator.userAgent.indexOf("Trident")&&-1<navigator.userAgent.indexOf("rv:11.0")},isMp4:function(e){var t=e.split("?")[0];return".mp4"===t.slice(t.length-4)}};k.TIMEOUT=5e3;var m={userId:S("#userId").val(),roomId:S("#roomId").val(),liveId:S("#liveId").val(),recordId:S("#recordId").val(),videoId:S("#videoId").val(),adapt:!1,isShowBar:0,viewerId:S("#viewerId").val(),upId:S("#upId").val(),viewer:{id:S("#viewerId").val(),name:S("#viewerName").val(),role:S("#viewerRole").val(),sessionId:S("#sessionId").val()},callbackPlayer:{id:"playbackPlayer",width:"100%",height:"100%"},drawPanel:{id:"playbackPanel",width:"100%",height:"100%"}},C={isDPReady:!1,dpc:{},fastMode:!1,init:function(){this.dpc=new Dpc},appendDrawPanel:function(){var e='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;"></iframe>';"isMobile"==A.isMobile()&&(e='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;pointer-events: none;"></iframe>'),S("#playbackPanel").parent().append(e),S("div#playbackPanel").remove(),"function"==typeof k.on_cc_live_db_flip&&k.on_cc_live_db_flip()},pageChange:function(e){this.isDPReady&&this.fastMode&&this.dpc.pageChange(e)},animationChange:function(e){this.isDPReady&&this.fastMode&&this.dpc.animationChange(e)},history:function(e){this.isDPReady&&this.fastMode&&this.dpc.history(e)},draw:function(e){this.isDPReady&&this.fastMode&&this.dpc.draw(e)},clear:function(){this.isDPReady&&this.fastMode&&this.dpc.clear()},docAdapt:function(e){if(this.isDPReady&&this.fastMode){var t=e?"1":"2";this.dpc.setDisplayMode(t)}}};var x={isH5play:!1,fastMode:!1,forceNew:!1,setFastMode:function(e){"string"==typeof e.fastMode?"false"===e.fastMode?this.fastMode=!1:this.fastMode=!0:"boolean"==typeof e.fastMode?this.fastMode=e.fastMode:this.fastMode=!1},config:function(e){(function i(){{if(D.createElement("video").canPlayType){var e=D.createElement("video"),t=e.canPlayType('video/ogg; codecs="theora, vorbis"');if(t)return"probably"==t;var a=e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');return!!a&&"probably"==a}return!1}})()&&(e.isH5play+""=="true"?this.isH5play=!0:this.isH5play=!1),this.setFastMode(e),C.fastMode=this.fastMode;var t=["//static.csslcloud.net/js/socket.io.js","//static.csslcloud.net/js/swfobject.js","//static.csslcloud.net/js/json3.min.js","//static.csslcloud.net/js/module/drawingBoard-2.0.0.js","//static.csslcloud.net/js/module/drawingBoardPlayback.js","//static.csslcloud.net/js/report.js"];C.fastMode&&t.splice(3,2),this.loadScript(t,function(){!function t(e){m.viewerId=e.viewerid,m=S.extend(m,e),M=new n(m)}(e),"isMobile"==A.isMobile()&&S.DrawingBoard&&!C.fastMode&&x.appendDrawPanel()}),"boolean"==typeof e.forceNew&&(this.forceNew=e.forceNew)},appendDrawPanel:function(){S("#playbackPanel").parent().append('<canvas id="drawPanel" width="1200" height="1200" style="position: absolute;z-index:2;top:0;left: 0"></canvas><iframe id="dpa" src="" frameborder="0" style="position: absolute;top:0;left: 0"></iframe>'),S("div#playbackPanel").remove()},logout:function(){S.ajax({url:"//view.csslcloud.net/api/callback/logout",type:"GET",dataType:"json",timeout:5e3,xhrFields:{withCredentials:!0},success:function(e){},error:function(e,t,a){}})},getScript:function(e,t){var a=!1,i=D.createElement("script");i.src=e,i.onload=i.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,t&&t())},D.body.appendChild(i)},loadScript:function(e,t){if("string"==typeof e){var a=e;(e=[]).push(a)}var i=this,s=function(e,t){i.getScript(e.shift(),function(){e.length?s(e,t):t&&t()})};s(e,t)},playbackRate:function(e){M.callbackPlayer.playbackRate(e)},seek:function(e){clearInterval(M.drawPanel.intervalNum),M.callbackPlayer.seek(e)},getPlayerTime:function(){return M.callbackPlayer.getPlayerTime()},getDuration:function(){return x.isH5play?A.getDuration():"isMobile"==A.isMobile()?A.getDuration():M.callbackPlayer.getDuration()},docAdapt:function(e){C.fastMode&&C.docAdapt(e),m.adapt=e},isShowBar:function(e){m.isShowBar=e},getBuffer:function(){return M.callbackPlayer.getBuffer()},setVolume:function(e){return M.callbackPlayer.setVolume(e)},getVolume:function(){return M.callbackPlayer.getVolume()},play:function(){return M.callbackPlayer.play()},setZScale:function(e){return M.callbackPlayer.setZScale(e)},getZScale:function(){return M.callbackPlayer.getZScale()},setScale:function(e){return M.callbackPlayer.setScale(e)},getScale:function(){return M.callbackPlayer.getScale()},openSettingPanel:function(){return M.callbackPlayer.openSettingPanel()}};function N(){M.isHistoryReady?function e(){M.callbackPlayer.isReady?M.drawPanel.intervalPainting(M):setTimeout(function(){e()},500)}():setTimeout(function(){N()},300)}S.extend({DW:x}),k.on_cc_callback_player=function(e){m.videoId=e.live.encryptRecordvideoId,m.recordId=e.encryptRecordId,M.callbackPlayer=new t(m)},k.on_cc_live_player_init=function(){M.callbackPlayer.isReady=!0;try{M.callbackPlayer.getFlash().start()}catch(a){}(setInterval(function(){var e=0;try{e=M.callbackPlayer.getPlayerTime()}catch(a){}if(!(e<=0)&&M.chatLogs.length)for(var t=M.chatLogs[0];t.time<=e&&(t=M.chatLogs.shift(),M.chatMessageCache.push({userid:t.userId,username:t.userName,time:t.time,msg:t.content,groupId:t.groupId,chatId:t.chatId,status:t.status,useravatar:t.userAvatar,userRole:t.userRole,usercustommark:t.userCustomMark,role:t.role}),M.chatLogs.length);)t=M.chatLogs[0]},1e3),setInterval(function(){var e=0;try{e=M.callbackPlayer.getPlayerTime()}catch(a){}if(!(e<=0)&&M.broadcasts.length)for(var t=M.broadcasts[0];t.time<=e&&(t=M.broadcasts.shift(),M.broadcastCache.push({content:t.content,time:t.time}),M.broadcasts.length);)t=M.broadcasts[0]},1e3),"function"==typeof k.on_cc_live_player_load&&k.on_cc_live_player_load(),on_cc_limit_request_draws)&&(parseInt(M.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},k.on_drampanel_ready=function(){M.drawPanel.isReady=!0,setTimeout(function(){N()},1500)},k.seekStart=function(){clearInterval(M.drawPanel.intervalNum)},k.seekComplete=function(){M.drawPanel.clear();var e=M.callbackPlayer.getPlayerTime();e<0&&(e=0),M.pageChangeIndex=-1,M.drawIndex=-1,M.animationIndex=-1;var t={pageChange:[],animation:[],draw:[]};if(M.pageChanges&&0<M.pageChanges.length){for(var a=0;a<M.pageChanges.length;a++){e>=(i=M.pageChanges[a]).time&&(M.pageChangeIndex=a)}if(0<=M.pageChangeIndex){var i=M.pageChanges[M.pageChangeIndex];"function"==typeof k.on_cc_callback_page_change&&k.on_cc_callback_page_change(i),"function"==typeof k.on_cc_request_snapshoot&&k.on_cc_request_snapshoot(i),C.fastMode?M.drawPanel.filp(i):M.drawPanel.filp(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,useSDK:i.useSDK})),t.pageChange.push(i)}}if(M.animations&&0<M.animations.length){for(a=0;a<M.animations.length;a++){e>=(r=M.animations[a]).time&&(M.animationIndex=a)}if(0<=M.animationIndex){var s=M.pageChangeIndex;if(0<=s){i=M.pageChanges[s];var r=M.animations[M.animationIndex];i&&r&&i.encryptDocId==r.encryptDocId&&e>=r.time&&i.time<=r.time&&(M.drawPanel.animation(JSON.stringify({fileName:r.docName,totalPage:r.docTotalPage,docid:r.encryptDocId,url:r.url,page:r.pageNum,step:r.step})),t.animation.push(r))}}}if(M.draws&&0<M.draws.length){for(a=0;a<M.draws.length;a++){(l=M.draws[a])&&e>=l.time&&(M.drawIndex=a)}var n=M.draws.slice(0,M.drawIndex+1);if(0<n.length){var o=[];for(a=0;a<n.length;a++){var l=n[a];o.push(l.data),t.draw.push(l)}M.drawPanel.draws(o)}}C.history(t),M.drawPanel.intervalNum=setInterval(function(){M.drawPanel.interval()},1e3)};var l={};l.addEvents=function(e,t,a){D.addEventListener?l.addEvents=function(e,t,a){e.addEventListener(t,a,!1)}:l.addEvents=function(e,t,a){e.attachEvent("on"+t,function(){a.call(e,arguments)})},l.addEvents(e,t,a)};var o=0,c=0,d=!0,A={pauseState:!1,useHls:!1,init:function(e){var r=this;function t(s){S.ajax({url:"//view.csslcloud.net/api/vod/v2/play/h5",type:"GET",dataType:"jsonp",data:{userid:s.userId,roomid:s.roomId,recordid:s.recordId,mp4:a},success:function(e){if("false"===e.isValid)x.isH5play=!1,M.callbackPlayer.flashPlayerInit();else if(e&&e.video&&0<e.video.length){var t=e.video[0],a=t.playurl,i=t.secureplayurl;"https:"===k.location.protocol&&i&&(a=i),r.appendVideo(a,s)}else k.on_cc_live_player_load_fail&&k.on_cc_live_player_load_fail()}})}var a=0;if(!A.isMobile()&&x.isH5play){if(g.log("浏览器版本是否是IE",g.isIE()),g.isIE())return a=1,this.useHls=!1,void t(e);a=0,this.useHls=!0;var i=D.createElement("script");return i.src="//static.csslcloud.net/js/hls.js?v="+parseInt(2e3*Math.random(),10),i.onload=function(){t(e)},void D.body.appendChild(i)}t(e)},appendVideo:function(e,t){var a=this,i='<video id="playbackVideo" webkit-playsinline playsinline controls autoplay x-webkit-airplay="deny" x5-playsinline width="100%" height="100%" src="'+e+'"></video>';S("#"+playbackPlayer.id).html(i);var s=D.getElementById("playbackVideo");if(this.useHls&&!g.isMp4(e)){if(Hls.isSupported()){var r=new Hls;r.attachMedia(s),r.on(Hls.Events.MEDIA_ATTACHED,function(){r.loadSource(e)})}}else S("#playbackVideo").attr("src",e);t.isShowBar&&s.removeAttribute("controls");var n=0,o=1;"isMobile"==A.isMobile()&&(n=1,o=11);new ReportLog(t,n,o,s,!1);this.isAndroid()||(this.pauseState=!0),l.addEvents(s,"canplay",function(){("isMobile"==A.isMobile()?(k.on_cc_live_player_load&&k.on_cc_live_player_load(),k.on_cc_h5_player_load&&k.on_cc_h5_player_load()):x.isH5play&&k.on_cc_live_player_init&&k.on_cc_live_player_init(),on_cc_limit_request_draws)&&(parseInt(M.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},!1),l.addEvents(s,"playing",function(){a.pauseState=!1,k.on_player_start&&on_player_start(),k.on_spark_player_resume&&on_spark_player_resume()},!1),l.addEvents(s,"pause",function(){a.pauseState=!0,k.on_spark_player_pause&&on_spark_player_pause()},!1),l.addEvents(s,"ended",function(){k.on_spark_player_end&&on_spark_player_end()},!1),l.addEvents(s,"seeking",function(){d=!1,seekStart&&seekStart()},!1),l.addEvents(s,"seeked",function(){d=!1,seekComplete&&seekComplete()},!1)},getDuration:function(){var e=D.getElementById("playbackVideo");if(e)return Math.floor(e.duration)},getPlayerTime:function(){var e=D.getElementById("playbackVideo");if(e)return Math.floor(e.currentTime)},end:function(){S("#"+playbackPlayer.id).html("end")},appendDoc:function(e){var t='<img src="'+e+'" />';S("#"+playbackPanel.id).append(t)},isMobile:function(){if(this.isIPad()||this.isIPhone()||this.isAndroid()||this.isWindowsPhone())return"isMobile"},isIPad:function(){return null!=navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!=navigator.userAgent.match(/iPhone/i)},isAndroid:function(){return null!=navigator.userAgent.match(/Android/i)},isWindowsPhone:function(){return null!=navigator.userAgent.match(/Windows Phone/i)}}}(jQuery,window,document,undefined)}]);