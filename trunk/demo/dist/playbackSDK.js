!function(a){var i={};function r(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=a,r.c=i,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(a,i,function(e){return t[e]}.bind(null,i));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([,function(e,t){!function(q,T,S){function t(e){this.isReady=!1,this.isPublishing=0,this.id=e.callbackPlayer.id;var t={userid:e.userId,videoid:e.videoId,recordid:e.recordId,isShowBar:e.isShowBar,upid:e.upId,viewerid:e.viewerId,roomid:e.roomId,ua:"1"},a={allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"};this.flashPlayerInit=function(){if(swfobject.embedSWF("//player.csslcloud.net/platform/live/CallbackPlayer.swf",e.callbackPlayer.id,e.callbackPlayer.width,e.callbackPlayer.height,"10.0.0","/flash/expressInstall.swf",t,a),"isMobile"!=x.isMobile())new ReportLog(e,0,1,null,!1)},R.isH5play||this.flashPlayerInit(),this.getFlash=function(){return swfobject.getObjectById(this.id)},this.playbackRate=function(e){if(R.isH5play||"isMobile"===x.isMobile()){e=parseFloat(e);this.getH5player().playbackRate=e}},this.seek=function(e){if(!(e<0))if(R.isH5play||"isMobile"==x.isMobile())this.getH5player().currentTime=e;else{var t=this.getFlash();if(!t)return;t.seek(e)}},this.getFlash=function(){return swfobject.getObjectById(this.id)},this.getH5player=function(){return q("#playbackVideo")[0]},this.getPlayerTime=function(){return this.isReady?(e=R.isH5play||"isMobile"==x.isMobile()?this.getH5player().currentTime:parseInt(this.getFlash().getPosition(),10),isNaN(e)||e<0?0:e):0;var e},this.getDuration=function(){if(R.isH5play||"isMobile"==x.isMobile())return this.getH5player().duration;var e=this.getFlash();return e?e.getDuration():void 0},this.getBuffer=function(){if(R.isH5play||"isMobile"==x.isMobile()){if(!this.getH5player()||!this.getH5player().buffered||!this.getH5player().buffered.end(0))return 0;for(var e=0,t=this.getH5player().buffered,a=0;a<t.length;a++)e+=t.end(a)-t.start(a);return e}var i=this.getFlash();if(i)return i.getBufferLength()},this.setVolume=function(e){if(!R.isH5play&&"isMobile"!=x.isMobile()){var t=this.getFlash();if(!t)return;return t.setVolume(e)}this.getH5player().volume=parseFloat(e)},this.getVolume=function(){if(R.isH5play||"isMobile"==x.isMobile())return this.getH5player().volume;var e=this.getFlash();return e?e.getVolume():void 0},this.play=function(){if(!R.isH5play&&"isMobile"!=x.isMobile()){var e=this.getFlash();if(!e)return;return e.isPlay()}x.pauseState?this.getH5player().play():this.getH5player().pause()},this.setZScale=function(e){var t=this.getFlash();if(t)return t.setZScale(e)},this.getZScale=function(){var e=this.getFlash();if(e)return e.getZScale()},this.setScale=function(e){var t=this.getFlash();if(t)return t.setScale(e)},this.getScale=function(){var e=this.getFlash();if(e)return e.getScale()},this.openSettingPanel=function(){var e=this.getFlash();if(e)return e.openSettingPanel()}}function k(e){var t="https:"===T.location.protocol,a=e.chat.host;if(t&&a&&a.indexOf(":")){var i=a.split(":");if(2==i.length){var r=parseInt(i[1]);if(!isNaN(r)){var s=r+400;a=i[0]+":"+s}}}var n=0;if("isMobile"==x.isMobile()&&(n=1),R.forceNew){io.connect(S.location.protocol+"//"+a+"/replay?roomid="+e.roomId+"&sessionid="+e.viewer.sessionId+"&platform=1&terminal="+n,{forceNew:!0});g.log("{forceNew: true}")}else{io.connect(S.location.protocol+"//"+a+"/replay",{query:{roomid:e.roomId,sessionid:e.viewer.sessionId,platform:1,terminal:n}});g.log("{forceNew: false}")}}function a(e,t){this.isReady=!1,M.fastMode||swfobject.embedSWF("//zeus.csslcloud.net/flash/Player.swf",e.drawPanel.id,e.drawPanel.width,e.drawPanel.height,"10.0.0","/flash/expressInstall.swf",{type:"drawpanel"},{allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"},{}),this.getFlash=function(){if(this.isReady)return swfobject.getObjectById(e.drawPanel.id)},this.clear=function(){M.clear();var e=this.getFlash();e&&e.clear()},this.draw=function(e){M.draw(e);var t=this.getFlash();t&&t.draw(e)},this.draws=function(e){var t,a=this.getFlash();a&&(t=e,setTimeout(function(){a.drawList(t)}))},this.filp=function(e){M.pageChange(e);var t=this.getFlash();if(t){var a=JSON.parse(e),i=a.url;"https:"===T.location.protocol&&(a.url=i.replace(/http:/g,"https:")),m.adapt?t.filp(JSON.stringify(a),"auto"):t.filp(JSON.stringify(a))}},this.animation=function(e){M.animationChange(e);var t=this.getFlash();t&&t.animation(e)},this.intervalNum=0,this.interval=function(){var e=0;try{e=D.callbackPlayer.getPlayerTime()}catch(n){}if(!(e<0)){d&&(c=e,2.5<=Math.abs(c-o)&&seekComplete&&seekComplete(),o=e),D.isRequestDraws&&D.drawsInfoRequestPool.isHttpRequestCurrentDraws(e,function(e){D.draws=e});try{if(D.animations&&0<D.animations.length)if(D.animationIndex<D.animations.length)if(0<=(r=D.pageChangeIndex)){var t=D.pageChanges[r],a=D.animations[D.animationIndex+1];t&&a&&t.encryptDocId==a.encryptDocId&&e>=a.time&&t.time<=a.time&&(M.fastMode?this.animation(a):this.animation(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,step:a.step})),D.animationIndex=D.animationIndex+1)}}catch(n){}try{if(D.pageChanges&&0<D.pageChanges.length)if(D.pageChangeIndex<D.pageChanges.length)if(e>=(t=D.pageChanges[D.pageChangeIndex+1]).time){"function"==typeof T.on_cc_callback_page_change&&T.on_cc_callback_page_change(t),"function"==typeof T.on_cc_request_snapshoot&&T.on_cc_request_snapshoot(t),M.fastMode?this.filp(t):this.filp(JSON.stringify({fileName:t.docName,totalPage:t.docTotalPage,docid:t.encryptDocId,url:t.url,page:t.pageNum,useSDK:t.useSDK})),D.pageChangeIndex=D.pageChangeIndex+1;var i={};i.docId=t.docId,i.docName=t.docName,i.docTotalPage=t.docTotalPage,i.pageNum=t.pageNum,"function"==typeof T.on_cc_callback_pagechange&&T.on_cc_callback_pagechange(i)}}catch(n){}try{var r;if(D.animations&&0<D.animations.length)if(D.animationIndex<D.animations.length)if(0<=(r=D.pageChangeIndex)){t=D.pageChanges[r],a=D.animations[D.animationIndex+1];t&&a&&t.encryptDocId==a.encryptDocId&&e>=a.time&&t.time<=a.time&&(M.fastMode?this.animation(a):this.animation(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,step:a.step})),D.animationIndex=D.animationIndex+1)}}catch(n){}try{if(D.draws&&0<D.draws.length&&D.drawIndex<D.draws.length)for(var s=D.draws[D.drawIndex+1];e>=s.time;)M.fastMode?this.draw(s):this.draw(s.data),D.drawIndex=D.drawIndex+1,s=D.draws[D.drawIndex+1]}catch(n){}}},this.intervalPainting=function(e){e.drawPanel.intervalNum=setInterval(function(){e.drawPanel.interval(e)},1e3)}}function h(i){q.ajax({url:i.url,type:"GET",data:i.data,tryCount:0,retryLimit:3,timeout:5e3,dataType:"jsonp",success:function(e){i.done(e)},error:function(e,t,a){if("timeout"==t)return this.tryCount++,this.tryCount<this.retryLimit?void q.ajax(this):void("function"==typeof i.fn&&i.fn(t));e.status}})}var f=function(){this.requestState=!1,this.result=0,this.startTime=0,this.endTime=0,this.key=0,this.index=0,this.ajax={},this.states=[],this.snapshoot=[],this.drawsAlready=0,this.roomId=m.roomId,this.userId=m.userId,this.recordId=m.recordId,this.liveId=m.liveId,this.drawRequestTime=m.drawRequestTime,this.setSnapshoot=function(e,t){this.snapshoot[e]=t},this.getSnapshoot=function(){return this.snapshoot},this.init=function(e){for(var t=0;t<this.drawRequestTime;t++){var a={requestState:!1,result:0,startTime:e.startTime,endTime:e.endTime,key:t};e.startTime=e.startTime+e.blockTime,e.endTime=e.startTime+e.blockTime,this.setState(a)}},this.httpRequest=function(e,t){var i=this;i.requestState=!0,this.ajax=q.ajax({url:e.url,type:"GET",data:e.param,tryCount:0,retryLimit:3,timeout:T.TIMEOUT,dataType:"jsonp",success:function(e){(i.result=e).success?(t(e),i.requestState=!1):g.log("data.success",e.success)},error:function(e,t,a){if("timeout"==t)return this.tryCount++,this.tryCount<this.retryLimit?(q.ajax(this),void g.log("ajax["+i.key+"] try again tryCount",this.tryCount)):(g.log("数据请求失败且重试多次"),void(i.requestState=!1));e.status}})},this.abort=function(){this.ajax.abort(),this.requestState=!1},this.setState=function(e){if("object"==typeof e){var t=e.key||this.index++;e.key&&!isNaN(e.key)&&(this.index=parseInt(e.key)+1);var a=new f;a.requestState=e.requestState||this.requestState,a.result=e.result||this.result,a.startTime=e.startTime||this.startTime,a.endTime=e.endTime||this.endTime,a.ajax=e.ajax||this.ajax,a.snapshoot=e.snapshoot||this.snapshoot,a.key=t,this.states[t]=a}},this.getState=function(e){return this.states[e]},this.getStates=function(){return this.states},this.getCurrentStateIndex=function(e){for(var t=0,a=0;a<this.states.length;a++)if(e>this.states[a].startTime&&e<=this.states[a].endTime){t=a;break}return t},this.isDrawsAlready=function(){return parseInt(this.drawRequestTime,10)===parseInt(this.drawsAlready,10)}},p=function(d,u){function h(e,t){var a=e.concat(t),i=[],r={};for(var s in a)r[JSON.stringify(a[s])]||(i.push(a[s]),r[JSON.stringify(a[s])]=1);return i}this.state=d,this.requestNumber=2,this.httpRequestPool=[],this.draws=[],this.preState={},this.isHttpRequestCurrentDraws=function(e,t){if(d.drawRequestTime){var a=d.isDrawsAlready();if(a)g.log("画笔数据加载完毕，不在预加载某一段数据");else{var i=d.getStates(),r=d.getCurrentStateIndex(e),s=i[r];if(this.preState!=s&&this.preState.requestState&&(g.log("发现新的预加载请求，中断上一个预加载请求;index="+this.preState.key),this.preState.abort()),this.preState=s,a||s.result||s.requestState)g.log("预加载过这段数据或已有数据;index="+r);else{g.log("预加载数据",r);var n={index:r,states:i};this.httpRequestCurrentDraws(n,t)}}}},this.httpRequestCurrentDraws=function(e,a){var i=this,t=e.states,r=e.index,s=t[r],n={url:"//view.csslcloud.net/api/view/replay/v2/draw/range",param:{starttime:s.startTime,endtime:s.endTime,userid:s.userId,recordid:s.recordId,liveid:s.liveId}};s.httpRequest(n,function(e){var t=e.datas.meta.draw;g.log("*** 预加载成功 callback.draws["+r+"] ***",t),i.draws=h(i.draws,t),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),a(i.draws),D.state.drawsAlready++})},this.httpRequestStream=function(r){var s=this;if(s.state.isDrawsAlready())return g.log("httpRequestStream draws already",s.draws),g.log("callback.state",D.state),void g.log("snapshoot",u);for(var e=s.state.getStates(),t=0;t<e.length;t++){if(!(i=e[t]).result&&!i.requestState){if(!(s.httpRequestPool.length<s.requestNumber))break;s.httpRequestPool.push(i)}}for(var a=0;a<s.httpRequestPool.length;a++){var i;(i=s.httpRequestPool[a]).result||i.requestState||function(i){var e={url:"//view.csslcloud.net/api/view/replay/v2/draw/range",param:{starttime:i.startTime,endtime:i.endTime,userid:i.userId,recordid:i.recordId,liveid:i.liveId}};i.httpRequest(e,function(e){var t=e.datas.meta.draw;g.log("请求流 draw["+i.key+"]",t),D.isRequestDraws?s.draws=h(s.draws,t):s.draws=s.draws.concat(t),s.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r(s.draws);for(var a=0;a<s.httpRequestPool.length;a++)if(s.httpRequestPool[a].key==i.key){s.httpRequestPool.splice(a,1);break}D.state.drawsAlready++,s.httpRequestStream(r)})}(i)}},this.httpRequestSnapshoot=function(a,e,i){var r=this;if(d.isDrawsAlready())g.log("画笔数据请求完整，不在请求快照数据");else{var t=d.getStates(),s=(e=e,d.getCurrentStateIndex(e)),n=t[s];if(n){var o=u.getSnapshoot(),l=o[a.docId+"_"+a.pageNum+"_"+a.url];if(n.result||l)g.log("当前时间段存在数据或存在快照",s+"");else{g.log("_snapshoot.getSnapshoot()",o),u.requestState&&u.abort();var c={url:"//view.csslcloud.net/api/view/replay/v2/draw/snapshot",param:{docid:a.docId,currentpage:a.pageNum,userid:u.userId,recordid:u.recordId}};u.httpRequest(c,function(e){if(u.setSnapshoot(a.docId+"_"+a.pageNum+"_"+a.url,e),n.result)g.log("快照请求成功，当前时间段数据存在，丢弃快照"+s);else{D.isRequestDraws=!0;var t=e.datas.meta.draw;g.log("*** 快照 callback.draws["+a.docId+"_"+a.pageNum+"_"+a.url+"] ***",t),r.draws=h(r.draws,t),r.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),i(r.draws)}})}}}}};T.ListenerDuration=function(){if(on_cc_limit_request_draws){var e=setInterval(function(){parseInt(D.callbackPlayer.getDuration())&&(g.log("ListenerDuration"),on_cc_limit_request_draws&&on_cc_limit_request_draws(),clearInterval(e))},50);T.ListenerDuration=null}},T.on_cc_limit_request_draws=function(){if(m.drawRequestTime){g.log("分页请求画笔数据",m.drawRequestTime);var e=D.callbackPlayer.getDuration()+1;g.log("duration",e+"");var t=Math.ceil(e/m.drawRequestTime),a={blockTime:t,startTime:0,endTime:0+t};D.state.init(a),g.log("callback.state",D.state),D.drawsInfoRequestPool.httpRequestStream(function(e){D.draws=e,D.isHistoryReady=!0,D.drawPanel.isReady=!0}),setTimeout(function(){C()},1500),T.on_cc_limit_request_draws=null}},T.on_cc_request_snapshoot=function(e){if(m.drawRequestTime){g.log("pageChange",e);var t=D.callbackPlayer.getPlayerTime();D.drawsInfoRequestPool.httpRequestSnapshoot(e,t,function(e){D.draws=e,D.isHistoryReady=!0,D.drawPanel.isReady=!0})}};function i(w,I){!function(e,t){var o={roomid:e.roomId,userid:e.userId,liveid:e.liveId,upid:e.upId,groupid:e.groupId,recordid:e.recordId,viewertoken:e.viewertoken,viewername:e.viewername,forcibly:e.forcibly},l={globalData:{},requestLoginData:!1,requestInfoData:!1,requestDrawData:!1,requestChatqaData:!1,allRequests:0};h({url:"//view.csslcloud.net/api/room/replay/login",data:o,fn:T.on_cc_login_error,done:function(e){if(!c(e,T.on_cc_login_error))return!1;if(e.success){m.drawRequestTime=parseInt(e.datas.drawRequestTime)||1,T.TIMEOUT=T.TIMEOUT+1e3*m.drawRequestTime,M.fastMode||(m.drawRequestTime=""),g.log("options",m),D.state=new f;var t=new f;D.drawsInfoRequestPool=new p(D.state,t)}if(d(l.globalData,e),l.requestLoginData=!0,l.requestInfoData=!1,l.requestDrawData=!1,l.requestChatqaData=!1,l.allRequests++,u(l),"function"==typeof T.on_cc_login_success){var a=e.datas,i={type:a.template.type,desc:a.template.desc,name:a.template.name},r={name:a.viewer.name,id:a.viewer.id,groupId:a.viewer.groupId},s={desc:a.room.desc,liveStartTime:a.room.liveStartTime,name:a.room.name,documentDisplayMode:a.room.documentDisplayMode,barrage:a.room.barrage},n={startTime:a.live.endTime,endTime:a.live.endTime};T.on_cc_login_success({template:i,viewer:r,room:s,live:n})}m.drawRequestTime||h({url:"//view.csslcloud.net/api/view/replay/draw/info",data:o,fn:T.on_cc_request_draw_error,done:function(e){if(!c(e))return!1;d(l.globalData,e),l.requestLoginData=!1,l.requestInfoData=!1,l.requestDrawData=!0,l.requestChatqaData=!1,l.allRequests++,u(l)}}),h({url:"//view.csslcloud.net/api/view/replay/v2/chatqa/info",data:o,fn:T.on_cc_request_chatqa_error,done:function(e){if(!c(e,T.on_cc_request_chatqa_error))return!1;d(l.globalData,e),l.requestLoginData=!1,l.requestInfoData=!1,l.requestDrawData=!1,l.requestChatqaData=!0,l.allRequests++,u(l)}}),h({url:"//view.csslcloud.net/api/view/replay/v2/info",data:o,fn:T.on_cc_request_info_error,done:function(e){if(!c(e,T.on_cc_request_info_error))return!1;d(l.globalData,e),l.requestLoginData=!1,l.requestInfoData=!0,l.requestDrawData=!1,l.requestChatqaData=!1,l.allRequests++,u(l)}})}});var c=function(e,t){return e.success?!!e.datas:("function"==typeof t&&t(e),!1)},d=function(e,t){a(e,t),e.datas.meta||(e.datas.meta={}),a(e.datas.meta,t.datas.meta)},a=function(e,t){for(var a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(e[a]=t[a])},u=function(e){t(e)}}(w,function P(e){var t=e.globalData;e.requestLoginData&&(M.fastMode&&(q("#documentDisplayMode").val(t.datas.room.documentDisplayMode),M.appendDrawPanel(),M.init()),w.chat={host:t.datas.pusherNode.primary},w.viewer.sessionId=t.datas.sessionId,w.liveId=t.datas.encryptLiveId,w.upId=t.datas.upId,w.viewerId=t.datas.viewer.id,I.socket=new k(w),q.DW.groupId=t.datas.viewer.groupId,"function"==typeof T.on_cc_callback_player&&T.on_cc_callback_player(t.datas),w.recordId||(w.recordId=t.datas.encryptRecordId),R.isH5play?x.init(w):"isMobile"==x.isMobile()&&x.init(w));var a=t.datas.meta;if(!a)return;if(e.requestInfoData){var i=a.pageChange;if(i){for(var r=0;r<i.length;r++){var s=i[r].url,n="https:"===T.location.protocol;0<s.indexOf("//")&&n&&(s=s.replace("http:","https:"),i[r].url=s)}"function"==typeof T.on_cc_callback_pages&&T.on_cc_callback_pages(i)}var o=a.pageChange;o&&o.length&&(o.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),I.pageChanges=o),I.pageChanges&&I.pageChanges.length&&I.drawPanel.filp(I.pageChanges[0]);var l=a.animation;l&&l.length&&(l.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),I.animations=l);var c=a.broadcast;if(T.chatLogs=a.broadcast,c&&c.length){c.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var r=0;r<c.length;r++){var d=c[r];"function"==typeof T.on_cc_live_broadcast_msg&&T.on_cc_live_broadcast_msg({content:d.content,time:d.time})}I.broadcasts=c}}if(e.requestChatqaData){var u=a.question;if(u&&u.length){u.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),I.questions=u;for(var r=0;r<I.questions.length;r++){var h=u[r];"function"==typeof T.on_cc_live_qa_question&&T.on_cc_live_qa_question({action:"question",value:{id:h.encryptId,content:h.content,groupId:h.groupId,userId:h.questionUserId,userName:h.questionUserName,userAvatar:h.questionUserAvatar,isPublish:h.isPublish}})}}var f=a.answer;if(f&&f.length){f.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),I.answers=f;for(var r=0;r<I.answers.length;r++){var p=f[r];"function"==typeof T.on_cc_live_qa_answer&&T.on_cc_live_qa_answer({action:"answer",value:{questionId:p.encryptId,content:p.content,userId:p.answerUserId,isPrivate:p.isPrivate,groupId:p.groupId,userName:p.answerUserName,userAvatar:p.answerUserAvatar,userRole:p.answerUserRole}})}}var g=a.chatLog;if(T.chatLogs=a.chatLog,g&&g.length){g.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var r=0;r<g.length;r++){var m=g[r];"function"==typeof T.on_cc_live_chat_msg&&T.on_cc_live_chat_msg({userid:m.userId,username:m.userName,time:m.time,msg:m.content,groupId:m.groupId,chatId:m.chatId,status:m.status,useravatar:m.userAvatar,userRole:m.userRole,usercustommark:m.userCustomMark,role:m.role})}I.chatLogs=g}T.chatLogs&&T.chatLogs.length&&(T.CHATLOGS=T.chatLogs,function y(){setInterval(function(){var e=0;try{e=parseInt(q("#playbackVideo")[0].currentTime,10)}catch(i){}if(!(e<=0)&&T.CHATLOGS.length)for(var t=T.CHATLOGS[0];t.time<=e;){var a=T.CHATLOGS.shift();if(D.chatMessageCache.push({userid:a.userId,username:a.userName,time:a.time,msg:a.content,groupId:a.groupId,useravatar:a.userAvatar,userRole:a.userRole,chatId:t.chatId,status:t.status,usercustommark:a.userCustomMark,role:a.role}),!T.CHATLOGS.length)break;t=T.CHATLOGS[0]}},1e3)}()),T.broadcasts&&T.broadcasts.length&&(T.BROADCASTS=T.broadcasts,function _(){setInterval(function(){var e=0;try{e=parseInt(q("#playbackVideo")[0].currentTime,10)}catch(i){}if(!(e<=0)&&T.BROADCASTS.length)for(var t=T.BROADCASTS[0];t.time<=e;){var a=T.BROADCASTS.shift();if(D.broadcastCache.push({content:a.content,time:a.time}),!T.BROADCASTS.length)break;t=T.BROADCASTS[0]}},1e3)}())}if(e.requestDrawData){var v=a.draw;v&&v.length&&(I.draws=v),I.isHistoryReady=!0,I.drawPanel.isReady=!0,setTimeout(function(){C()},1500)}T.on_cc_h5_player_load=function(){if(I.callbackPlayer.isReady=!0,!b){b=!0;var e=S.getElementById("drawPanel");e&&q.Callback.config({playerId:"playbackVideo"},a)}}});var b=!1}function r(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){D.broadcastCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],t=Math.min(this.cache.length,10),a=0;a<t;a++)e.push(this.cache.shift());"function"==typeof T.on_cc_live_broadcast_msg_sync&&T.on_cc_live_broadcast_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){D.broadcastCache.refresh()},80)}}}function s(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){D.chatMessageCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],t=Math.min(this.cache.length,10),a=0;a<t;a++)e.push(this.cache.shift());"function"==typeof T.on_cc_live_chat_msg_sync&&T.on_cc_live_chat_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){D.chatMessageCache.refresh()},80)}}}function n(e){this.chatLogs=[],this.broadcasts=[],this.draws=[],this.pageChanges=[],this.isHistoryReady=!1,this.questions=[],this.answers=[],this.pageChanges=[],this.draws=[],this.animations=[],this.pageChangeIndex=-1,this.drawIndex=-1,this.animationIndex=-1,this.isRequestDraws=!1,this.drawPanel=new a(e,this),this.history=new i(e,this),this.chatMessageCache=new s,this.broadcastCache=new r}var D={};T.isDebug=!1;var g={isDebug:T.isDebug,log:function(e,t){T.isDebug&&T.console&&"function"==typeof console.log&&(t?console.log(e+" => ",t):console.log(e))},isIE:function(){return-1<navigator.userAgent.indexOf("compatible")&&-1<navigator.userAgent.indexOf("MSIE")?(-1<navigator.userAgent.indexOf("MSIE 9.0")||navigator.userAgent.indexOf("MSIE 10.0"),!0):-1<navigator.userAgent.indexOf("Trident")&&-1<navigator.userAgent.indexOf("rv:11.0")},isMp4:function(e){var t=e.split("?")[0];return".mp4"===t.slice(t.length-4)}};T.TIMEOUT=5e3;var m={userId:q("#userId").val(),roomId:q("#roomId").val(),liveId:q("#liveId").val(),recordId:q("#recordId").val(),videoId:q("#videoId").val(),adapt:!1,isShowBar:0,viewerId:q("#viewerId").val(),upId:q("#upId").val(),viewer:{id:q("#viewerId").val(),name:q("#viewerName").val(),role:q("#viewerRole").val(),sessionId:q("#sessionId").val()},callbackPlayer:{id:"playbackPlayer",width:"100%",height:"100%"},drawPanel:{id:"playbackPanel",width:"100%",height:"100%"}},M={dpc:{},fastMode:!1,init:function(){this.dpc=new Dpc},appendDrawPanel:function(){var e='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;"></iframe>';"isMobile"==x.isMobile()&&(e='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;pointer-events: none;"></iframe>'),q("#playbackPanel").parent().append(e),q("div#playbackPanel").remove(),"function"==typeof T.on_cc_live_db_flip&&T.on_cc_live_db_flip()},pageChange:function(e){this.fastMode&&this.dpc.pageChange(e)},animationChange:function(e){this.fastMode&&this.dpc.animationChange(e)},history:function(e){this.fastMode&&this.dpc.history(e)},draw:function(e){this.fastMode&&this.dpc.draw(e)},clear:function(){this.fastMode&&this.dpc.clear()},docAdapt:function(e){if(this.fastMode){var t=e?"1":"2";this.dpc.setDisplayMode(t)}}};var R={isH5play:!1,fastMode:!1,forceNew:!1,setFastMode:function(e){"string"==typeof e.fastMode?"false"===e.fastMode?this.fastMode=!1:this.fastMode=!0:"boolean"==typeof e.fastMode?this.fastMode=e.fastMode:this.fastMode=!1},config:function(e){(function i(){{if(S.createElement("video").canPlayType){var e=S.createElement("video"),t=e.canPlayType('video/ogg; codecs="theora, vorbis"');if(t)return"probably"==t;var a=e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');return!!a&&"probably"==a}return!1}})()&&(e.isH5play+""=="true"?this.isH5play=!0:this.isH5play=!1),this.setFastMode(e),M.fastMode=this.fastMode;var t=["//static.csslcloud.net/js/socket.io.js","//static.csslcloud.net/js/swfobject.js","//image.csslcloud.net/js/dpc.js?v="+Math.floor(1e4*Math.random()),"//static.csslcloud.net/js/json3.min.js","//static.csslcloud.net/js/module/drawingBoard-2.0.0.js","//static.csslcloud.net/js/module/drawingBoardPlayback.js","//static.csslcloud.net/js/report.js"];M.fastMode&&t.splice(3,2),this.loadScript(t,function(){!function t(e){m.viewerId=e.viewerid,m=q.extend(m,e),D=new n(m)}(e),"isMobile"==x.isMobile()&&q.DrawingBoard&&!M.fastMode&&R.appendDrawPanel()}),"boolean"==typeof e.forceNew&&(this.forceNew=e.forceNew)},appendDrawPanel:function(){q("#playbackPanel").parent().append('<canvas id="drawPanel" width="1200" height="1200" style="position: absolute;z-index:2;top:0;left: 0"></canvas><iframe id="dpa" src="" frameborder="0" style="position: absolute;top:0;left: 0"></iframe>'),q("div#playbackPanel").remove()},logout:function(){q.ajax({url:"//view.csslcloud.net/api/callback/logout",type:"GET",dataType:"json",timeout:5e3,xhrFields:{withCredentials:!0},success:function(e){},error:function(e,t,a){}})},getScript:function(e,t){var a=!1,i=S.createElement("script");i.src=e,i.onload=i.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,t&&t())},S.body.appendChild(i)},loadScript:function(e,t){if("string"==typeof e){var a=e;(e=[]).push(a)}var i=this,r=function(e,t){i.getScript(e.shift(),function(){e.length?r(e,t):t&&t()})};r(e,t)},playbackRate:function(e){D.callbackPlayer.playbackRate(e)},seek:function(e){clearInterval(D.drawPanel.intervalNum),D.callbackPlayer.seek(e)},getPlayerTime:function(){return D.callbackPlayer.getPlayerTime()},getDuration:function(){return R.isH5play?x.getDuration():"isMobile"==x.isMobile()?x.getDuration():D.callbackPlayer.getDuration()},docAdapt:function(e){M.fastMode&&M.docAdapt(e),m.adapt=e},isShowBar:function(e){m.isShowBar=e},getBuffer:function(){return D.callbackPlayer.getBuffer()},setVolume:function(e){return D.callbackPlayer.setVolume(e)},getVolume:function(){return D.callbackPlayer.getVolume()},play:function(){return D.callbackPlayer.play()},setZScale:function(e){return D.callbackPlayer.setZScale(e)},getZScale:function(){return D.callbackPlayer.getZScale()},setScale:function(e){return D.callbackPlayer.setScale(e)},getScale:function(){return D.callbackPlayer.getScale()},openSettingPanel:function(){return D.callbackPlayer.openSettingPanel()}};function C(){D.isHistoryReady?function e(){D.callbackPlayer.isReady?D.drawPanel.intervalPainting(D):setTimeout(function(){e()},500)}():setTimeout(function(){C()},300)}q.extend({DW:R}),T.on_cc_callback_player=function(e){m.videoId=e.live.encryptRecordvideoId,m.recordId=e.encryptRecordId,D.callbackPlayer=new t(m)},T.on_cc_live_player_init=function(){D.callbackPlayer.isReady=!0;try{D.callbackPlayer.getFlash().start()}catch(a){}(setInterval(function(){var e=0;try{e=D.callbackPlayer.getPlayerTime()}catch(a){}if(!(e<=0)&&D.chatLogs.length)for(var t=D.chatLogs[0];t.time<=e&&(t=D.chatLogs.shift(),D.chatMessageCache.push({userid:t.userId,username:t.userName,time:t.time,msg:t.content,groupId:t.groupId,chatId:t.chatId,status:t.status,useravatar:t.userAvatar,userRole:t.userRole,usercustommark:t.userCustomMark,role:t.role}),D.chatLogs.length);)t=D.chatLogs[0]},1e3),setInterval(function(){var e=0;try{e=D.callbackPlayer.getPlayerTime()}catch(a){}if(!(e<=0)&&D.broadcasts.length)for(var t=D.broadcasts[0];t.time<=e&&(t=D.broadcasts.shift(),D.broadcastCache.push({content:t.content,time:t.time}),D.broadcasts.length);)t=D.broadcasts[0]},1e3),"function"==typeof T.on_cc_live_player_load&&T.on_cc_live_player_load(),on_cc_limit_request_draws)&&(parseInt(D.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},T.on_drampanel_ready=function(){D.drawPanel.isReady=!0,setTimeout(function(){C()},1500)},T.seekStart=function(){clearInterval(D.drawPanel.intervalNum)},T.seekComplete=function(){D.drawPanel.clear();var e=D.callbackPlayer.getPlayerTime();e<0&&(e=0),D.pageChangeIndex=-1,D.drawIndex=-1,D.animationIndex=-1;var t={pageChange:[],animation:[],draw:[]};if(D.pageChanges&&0<D.pageChanges.length){for(var a=0;a<D.pageChanges.length;a++){e>=(i=D.pageChanges[a]).time&&(D.pageChangeIndex=a)}if(0<=D.pageChangeIndex){var i=D.pageChanges[D.pageChangeIndex];"function"==typeof T.on_cc_callback_page_change&&T.on_cc_callback_page_change(i),"function"==typeof T.on_cc_request_snapshoot&&T.on_cc_request_snapshoot(i),D.drawPanel.filp(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,useSDK:i.useSDK})),t.pageChange.push(i)}}if(D.animations&&0<D.animations.length){for(a=0;a<D.animations.length;a++){e>=(s=D.animations[a]).time&&(D.animationIndex=a)}if(0<=D.animationIndex){var r=D.pageChangeIndex;if(0<=r){i=D.pageChanges[r];var s=D.animations[D.animationIndex];i&&s&&i.encryptDocId==s.encryptDocId&&e>=s.time&&i.time<=s.time&&(D.drawPanel.animation(JSON.stringify({fileName:s.docName,totalPage:s.docTotalPage,docid:s.encryptDocId,url:s.url,page:s.pageNum,step:s.step})),t.animation.push(s))}}}if(D.draws&&0<D.draws.length){for(a=0;a<D.draws.length;a++){(l=D.draws[a])&&e>=l.time&&(D.drawIndex=a)}var n=D.draws.slice(0,D.drawIndex+1);if(0<n.length){var o=[];for(a=0;a<n.length;a++){var l=n[a];o.push(l.data),t.draw.push(l)}D.drawPanel.draws(o)}}M.history(t),D.drawPanel.intervalNum=setInterval(function(){D.drawPanel.interval()},1e3)};var l={};l.addEvents=function(e,t,a){S.addEventListener?l.addEvents=function(e,t,a){e.addEventListener(t,a,!1)}:l.addEvents=function(e,t,a){e.attachEvent("on"+t,function(){a.call(e,arguments)})},l.addEvents(e,t,a)};var o=0,c=0,d=!0,x={pauseState:!1,useHls:!1,init:function(e){var s=this;function t(r){q.ajax({url:"//view.csslcloud.net/api/vod/v2/play/h5",type:"GET",dataType:"jsonp",data:{userid:r.userId,roomid:r.roomId,recordid:r.recordId,mp4:a},success:function(e){if("false"===e.isValid)R.isH5play=!1,D.callbackPlayer.flashPlayerInit();else if(e&&e.video&&0<e.video.length){var t=e.video[0],a=t.playurl,i=t.secureplayurl;"https:"===T.location.protocol&&i&&(a=i),s.appendVideo(a,r)}else T.on_cc_live_player_load_fail&&T.on_cc_live_player_load_fail()}})}var a=0;if(!x.isMobile()&&R.isH5play){if(g.log("浏览器版本是否是IE",g.isIE()),g.isIE())return a=1,this.useHls=!1,void t(e);a=0,this.useHls=!0;var i=S.createElement("script");return i.src="//static.csslcloud.net/js/hls.js?v="+parseInt(2e3*Math.random(),10),i.onload=function(){t(e)},void S.body.appendChild(i)}t(e)},appendVideo:function(e,t){var a=this,i='<video id="playbackVideo" webkit-playsinline playsinline controls autoplay x-webkit-airplay="deny" x5-playsinline width="100%" height="100%" src="'+e+'"></video>';q("#"+playbackPlayer.id).html(i);var r=S.getElementById("playbackVideo");if(this.useHls&&!g.isMp4(e)){if(Hls.isSupported()){var s=new Hls;s.attachMedia(r),s.on(Hls.Events.MEDIA_ATTACHED,function(){s.loadSource(e)})}}else q("#playbackVideo").attr("src",e);t.isShowBar&&r.removeAttribute("controls");var n=0,o=1;"isMobile"==x.isMobile()&&(n=1,o=11);new ReportLog(t,n,o,r,!1);this.isAndroid()||(this.pauseState=!0),l.addEvents(r,"canplay",function(){("isMobile"==x.isMobile()?(T.on_cc_live_player_load&&T.on_cc_live_player_load(),T.on_cc_h5_player_load&&T.on_cc_h5_player_load()):R.isH5play&&T.on_cc_live_player_init&&T.on_cc_live_player_init(),on_cc_limit_request_draws)&&(parseInt(D.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},!1),l.addEvents(r,"playing",function(){a.pauseState=!1,T.on_player_start&&on_player_start(),T.on_spark_player_resume&&on_spark_player_resume()},!1),l.addEvents(r,"pause",function(){a.pauseState=!0,T.on_spark_player_pause&&on_spark_player_pause()},!1),l.addEvents(r,"ended",function(){T.on_spark_player_end&&on_spark_player_end()},!1),l.addEvents(r,"seeking",function(){d=!1,seekStart&&seekStart()},!1),l.addEvents(r,"seeked",function(){d=!1,seekComplete&&seekComplete()},!1)},getDuration:function(){var e=S.getElementById("playbackVideo");if(e)return Math.floor(e.duration)},getPlayerTime:function(){var e=S.getElementById("playbackVideo");if(e)return Math.floor(e.currentTime)},end:function(){q("#"+playbackPlayer.id).html("end")},appendDoc:function(e){var t='<img src="'+e+'" />';q("#"+playbackPanel.id).append(t)},isMobile:function(){if(this.isIPad()||this.isIPhone()||this.isAndroid()||this.isWindowsPhone())return"isMobile"},isIPad:function(){return null!=navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!=navigator.userAgent.match(/iPhone/i)},isAndroid:function(){return null!=navigator.userAgent.match(/Android/i)},isWindowsPhone:function(){return null!=navigator.userAgent.match(/Windows Phone/i)}}}(jQuery,window,document,undefined)}]);