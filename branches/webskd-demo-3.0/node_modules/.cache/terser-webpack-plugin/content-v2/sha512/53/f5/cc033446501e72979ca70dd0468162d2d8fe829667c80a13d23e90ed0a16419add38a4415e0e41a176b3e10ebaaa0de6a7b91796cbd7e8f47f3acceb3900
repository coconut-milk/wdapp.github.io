{"code":"!function(e){var t={};function a(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)a.d(i,r,function(t){return e[t]}.bind(null,r));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,\"a\",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p=\"\",a(a.s=11)}({11:function(e,t,a){\"use strict\";function i(e){return(i=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}!function(e,t,a){var r=function(t){this.isReady=!1,this.isPublishing=0,this.id=t.callbackPlayer.id;var a={userid:t.userId,videoid:t.videoId,recordid:t.recordId,isShowBar:t.isShowBar,upid:t.upId,viewerid:t.viewerId,roomid:t.roomId,ua:\"1\"},i={allowFullscreen:\"true\",allowScriptAccess:\"always\",wmode:\"transparent\"};this.flashPlayerInit=function(){swfobject.embedSWF(\"//player.csslcloud.net/platform/live/CallbackPlayer.swf\",t.callbackPlayer.id,t.callbackPlayer.width,t.callbackPlayer.height,\"10.0.0\",\"/flash/expressInstall.swf\",a,i),\"isMobile\"!=q.isMobile()&&new ReportLog(t,0,1,null,!1)},v.isH5play||this.flashPlayerInit(),this.getFlash=function(){return swfobject.getObjectById(this.id)},this.playbackRate=function(e){(v.isH5play||\"isMobile\"===q.isMobile())&&(e=parseFloat(e),this.getH5player().playbackRate=e)},this.seek=function(e){if(!(e<0))if(v.isH5play||\"isMobile\"==q.isMobile())this.getH5player().currentTime=e;else{var t=this.getFlash();if(!t)return;t.seek(e)}},this.getFlash=function(){return swfobject.getObjectById(this.id)},this.getH5player=function(){return e(\"#playbackVideo\")[0]},this.getPlayerTime=function(){return this.isReady?(e=v.isH5play||\"isMobile\"==q.isMobile()?this.getH5player().currentTime:parseInt(this.getFlash().getPosition(),10),isNaN(e)||e<0?0:e):0;var e},this.getDuration=function(){if(v.isH5play||\"isMobile\"==q.isMobile())return this.getH5player().duration;var e=this.getFlash();return e?e.getDuration():void 0},this.getBuffer=function(){if(v.isH5play||\"isMobile\"==q.isMobile())return this.getH5player()&&this.getH5player().buffered&&this.getH5player().buffered.end(0)?this.getH5player().buffered.end(0):0;var e=this.getFlash();return e?e.getBufferLength():void 0},this.setVolume=function(e){if(!v.isH5play&&\"isMobile\"!=q.isMobile()){var t=this.getFlash();if(!t)return;return t.setVolume(e)}this.getH5player().volume=parseFloat(e)},this.getVolume=function(){if(v.isH5play||\"isMobile\"==q.isMobile())return this.getH5player().volume;var e=this.getFlash();return e?e.getVolume():void 0},this.play=function(){if(!v.isH5play&&\"isMobile\"!=q.isMobile()){var e=this.getFlash();if(!e)return;return e.isPlay()}q.pauseState?this.getH5player().play():this.getH5player().pause()},this.setZScale=function(e){var t=this.getFlash();if(t)return t.setZScale(e)},this.getZScale=function(){var e=this.getFlash();if(e)return e.getZScale()},this.setScale=function(e){var t=this.getFlash();if(t)return t.setScale(e)},this.getScale=function(){var e=this.getFlash();if(e)return e.getScale()},this.openSettingPanel=function(){var e=this.getFlash();if(e)return e.openSettingPanel()}},s=function(e){var i=\"https:\"===t.location.protocol,r=e.chat.host;if(i&&r&&r.indexOf(\":\")){var s=r.split(\":\");if(2==s.length){var n=parseInt(s[1]);if(!isNaN(n)){var o=n+400;r=s[0]+\":\"+o}}}var l=0;\"isMobile\"==q.isMobile()&&(l=1),v.forceNew?(io.connect(a.location.protocol+\"//\"+r+\"/replay?roomid=\"+e.roomId+\"&sessionid=\"+e.viewer.sessionId+\"&platform=1&terminal=\"+l,{forceNew:!0}),g.log(\"{forceNew: true}\")):(io.connect(a.location.protocol+\"//\"+r+\"/replay\",{query:{roomid:e.roomId,sessionid:e.viewer.sessionId,platform:1,terminal:l}}),g.log(\"{forceNew: false}\"))},n=function(e,a){this.isReady=!1,y.fastMode||swfobject.embedSWF(\"//zeus.csslcloud.net/flash/Player.swf\",e.drawPanel.id,e.drawPanel.width,e.drawPanel.height,\"10.0.0\",\"/flash/expressInstall.swf\",{type:\"drawpanel\"},{allowFullscreen:\"true\",allowScriptAccess:\"always\",wmode:\"transparent\"},{}),this.getFlash=function(){if(this.isReady)return swfobject.getObjectById(e.drawPanel.id)},this.clear=function(){y.clear();var e=this.getFlash();e&&e.clear()},this.draw=function(e){y.draw(e);var t=this.getFlash();t&&t.draw(e)},this.draws=function(e){var t,a=this.getFlash();a&&(t=e,setTimeout(function(){a.drawList(t)}))},this.filp=function(e){y.pageChange(e);var a=this.getFlash();if(a){var i=JSON.parse(e),r=i.url;\"https:\"===t.location.protocol&&(i.url=r.replace(/http:/g,\"https:\")),m.adapt?a.filp(JSON.stringify(i),\"auto\"):a.filp(JSON.stringify(i))}},this.animation=function(e){y.animationChange(e);var t=this.getFlash();t&&t.animation(e)},this.intervalNum=0,this.interval=function(){var e=0;try{e=f.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<0)){P&&(b=e,2.5<=Math.abs(b-I)&&seekComplete&&seekComplete(),I=e),f.isRequestDraws&&f.drawsInfoRequestPool.isHttpRequestCurrentDraws(e,function(e){f.draws=e});try{if(f.animations&&0<f.animations.length&&f.animationIndex<f.animations.length&&0<=(s=f.pageChangeIndex)){var a=f.pageChanges[s],i=f.animations[f.animationIndex+1];a&&i&&a.encryptDocId==i.encryptDocId&&e>=i.time&&a.time<=i.time&&(y.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),f.animationIndex=f.animationIndex+1)}}catch(e){}try{if(f.pageChanges&&0<f.pageChanges.length&&f.pageChangeIndex<f.pageChanges.length&&e>=(a=f.pageChanges[f.pageChangeIndex+1]).time){\"function\"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(a),\"function\"==typeof t.on_cc_request_snapshoot&&t.on_cc_request_snapshoot(a),y.fastMode?this.filp(a):this.filp(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,useSDK:a.useSDK})),f.pageChangeIndex=f.pageChangeIndex+1;var r={};r.docId=a.docId,r.docName=a.docName,r.docTotalPage=a.docTotalPage,r.pageNum=a.pageNum,\"function\"==typeof t.on_cc_callback_pagechange&&t.on_cc_callback_pagechange(r)}}catch(e){}try{var s;f.animations&&0<f.animations.length&&f.animationIndex<f.animations.length&&0<=(s=f.pageChangeIndex)&&(a=f.pageChanges[s],i=f.animations[f.animationIndex+1],a&&i&&a.encryptDocId==i.encryptDocId&&e>=i.time&&a.time<=i.time&&(y.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),f.animationIndex=f.animationIndex+1))}catch(e){}try{if(f.draws&&0<f.draws.length&&f.drawIndex<f.draws.length)for(var n=f.draws[f.drawIndex+1];e>=n.time;)y.fastMode?this.draw(n):this.draw(n.data),f.drawIndex=f.drawIndex+1,n=f.draws[f.drawIndex+1]}catch(e){}}},this.intervalPainting=function(e){e.drawPanel.intervalNum=setInterval(function(){e.drawPanel.interval(e)},1e3)}},o=function(t){e.ajax({url:t.url,type:\"GET\",data:t.data,tryCount:0,retryLimit:3,timeout:5e3,dataType:\"jsonp\",success:function(e){t.done(e)},error:function(a,i,r){if(\"timeout\"==i)return this.tryCount++,this.tryCount<this.retryLimit?void e.ajax(this):void(\"function\"==typeof t.fn&&t.fn(i));a.status}})},l=function a(){this.requestState=!1,this.result=0,this.startTime=0,this.endTime=0,this.key=0,this.index=0,this.ajax={},this.states=[],this.snapshoot=[],this.drawsAlready=0,this.roomId=m.roomId,this.userId=m.userId,this.recordId=m.recordId,this.liveId=m.liveId,this.drawRequestTime=m.drawRequestTime,this.setSnapshoot=function(e,t){this.snapshoot[e]=t},this.getSnapshoot=function(){return this.snapshoot},this.init=function(e){for(var t=0;t<this.drawRequestTime;t++){var a={requestState:!1,result:0,startTime:e.startTime,endTime:e.endTime,key:t};e.startTime=e.startTime+e.blockTime,e.endTime=e.startTime+e.blockTime,this.setState(a)}},this.httpRequest=function(a,i){var r=this;r.requestState=!0,this.ajax=e.ajax({url:a.url,type:\"GET\",data:a.param,tryCount:0,retryLimit:3,timeout:t.TIMEOUT,dataType:\"jsonp\",success:function(e){(r.result=e).success?(i(e),r.requestState=!1):g.log(\"data.success\",e.success)},error:function(t,a,i){if(\"timeout\"==a)return this.tryCount++,this.tryCount<this.retryLimit?(e.ajax(this),void g.log(\"ajax[\"+r.key+\"] try again tryCount\",this.tryCount)):(g.log(\"数据请求失败且重试多次\"),void(r.requestState=!1));t.status}})},this.abort=function(){this.ajax.abort(),this.requestState=!1},this.setState=function(e){if(\"object\"===i(e)){var t=e.key||this.index++;e.key&&!isNaN(e.key)&&(this.index=parseInt(e.key)+1);var r=new a;r.requestState=e.requestState||this.requestState,r.result=e.result||this.result,r.startTime=e.startTime||this.startTime,r.endTime=e.endTime||this.endTime,r.ajax=e.ajax||this.ajax,r.snapshoot=e.snapshoot||this.snapshoot,r.key=t,this.states[t]=r}},this.getState=function(e){return this.states[e]},this.getStates=function(){return this.states},this.getCurrentStateIndex=function(e){for(var t=0,a=0;a<this.states.length;a++)if(e>this.states[a].startTime&&e<=this.states[a].endTime){t=a;break}return t},this.isDrawsAlready=function(){return parseInt(this.drawRequestTime,10)===parseInt(this.drawsAlready,10)}},c=function(e,t){function a(e,t){var a=e.concat(t),i=[],r={};for(var s in a)r[JSON.stringify(a[s])]||(i.push(a[s]),r[JSON.stringify(a[s])]=1);return i}this.state=e,this.requestNumber=2,this.httpRequestPool=[],this.draws=[],this.preState={},this.isHttpRequestCurrentDraws=function(t,a){if(e.drawRequestTime){var i=e.isDrawsAlready();if(i)g.log(\"画笔数据加载完毕，不在预加载某一段数据\");else{var r=e.getStates(),s=e.getCurrentStateIndex(t),n=r[s];if(this.preState!=n&&this.preState.requestState&&(g.log(\"发现新的预加载请求，中断上一个预加载请求;index=\"+this.preState.key),this.preState.abort()),this.preState=n,i||n.result||n.requestState)g.log(\"预加载过这段数据或已有数据;index=\"+s);else{g.log(\"预加载数据\",s);var o={index:s,states:r};this.httpRequestCurrentDraws(o,a)}}}},this.httpRequestCurrentDraws=function(e,t){var i=this,r=e.states,s=e.index,n=r[s],o={url:\"//view.csslcloud.net/api/view/replay/v2/draw/range\",param:{starttime:n.startTime,endtime:n.endTime,userid:n.userId,recordid:n.recordId,liveid:n.liveId}};n.httpRequest(o,function(e){var r=e.datas.meta.draw;g.log(\"*** 预加载成功 callback.draws[\"+s+\"] ***\",r),i.draws=a(i.draws,r),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),t(i.draws),f.state.drawsAlready++})},this.httpRequestStream=function(e){var i=this;if(i.state.isDrawsAlready())return g.log(\"httpRequestStream draws already\",i.draws),g.log(\"callback.state\",f.state),void g.log(\"snapshoot\",t);for(var r=i.state.getStates(),s=0;s<r.length;s++)if(!(o=r[s]).result&&!o.requestState){if(!(i.httpRequestPool.length<i.requestNumber))break;i.httpRequestPool.push(o)}for(var n=0;n<i.httpRequestPool.length;n++){var o;(o=i.httpRequestPool[n]).result||o.requestState||function(t){var r={url:\"//view.csslcloud.net/api/view/replay/v2/draw/range\",param:{starttime:t.startTime,endtime:t.endTime,userid:t.userId,recordid:t.recordId,liveid:t.liveId}};t.httpRequest(r,function(r){var s=r.datas.meta.draw;g.log(\"请求流 draw[\"+t.key+\"]\",s),f.isRequestDraws?i.draws=a(i.draws,s):i.draws=i.draws.concat(s),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),e(i.draws);for(var n=0;n<i.httpRequestPool.length;n++)if(i.httpRequestPool[n].key==t.key){i.httpRequestPool.splice(n,1);break}f.state.drawsAlready++,i.httpRequestStream(e)})}(o)}},this.httpRequestSnapshoot=function(i,r,s){var n=this;if(e.isDrawsAlready())g.log(\"画笔数据请求完整，不在请求快照数据\");else{var o=e.getStates(),l=(r=r,e.getCurrentStateIndex(r)),c=o[l];if(c){var u=t.getSnapshoot(),d=u[i.docId+\"_\"+i.pageNum+\"_\"+i.url];if(c.result||d)g.log(\"当前时间段存在数据或存在快照\",l+\"\");else{g.log(\"_snapshoot.getSnapshoot()\",u),t.requestState&&t.abort();var h={url:\"//view.csslcloud.net/api/view/replay/v2/draw/snapshot\",param:{docid:i.docId,currentpage:i.pageNum,userid:t.userId,recordid:t.recordId}};t.httpRequest(h,function(e){if(t.setSnapshoot(i.docId+\"_\"+i.pageNum+\"_\"+i.url,e),c.result)g.log(\"快照请求成功，当前时间段数据存在，丢弃快照\"+l);else{f.isRequestDraws=!0;var r=e.datas.meta.draw;g.log(\"*** 快照 callback.draws[\"+i.docId+\"_\"+i.pageNum+\"_\"+i.url+\"] ***\",r),n.draws=a(n.draws,r),n.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),s(n.draws)}})}}}}};t.ListenerDuration=function(){if(on_cc_limit_request_draws){var e=setInterval(function(){parseInt(f.callbackPlayer.getDuration())&&(g.log(\"ListenerDuration\"),on_cc_limit_request_draws&&on_cc_limit_request_draws(),clearInterval(e))},50);t.ListenerDuration=null}},t.on_cc_limit_request_draws=function(){if(m.drawRequestTime){g.log(\"分页请求画笔数据\",m.drawRequestTime);var e=f.callbackPlayer.getDuration()+1;g.log(\"duration\",e+\"\");var a=Math.ceil(e/m.drawRequestTime),i={blockTime:a,startTime:0,endTime:0+a};f.state.init(i),g.log(\"callback.state\",f.state),f.drawsInfoRequestPool.httpRequestStream(function(e){f.draws=e,f.isHistoryReady=!0,f.drawPanel.isReady=!0}),setTimeout(function(){w()},1500),t.on_cc_limit_request_draws=null}},t.on_cc_request_snapshoot=function(e){if(m.drawRequestTime){g.log(\"pageChange\",e);var t=f.callbackPlayer.getPlayerTime();f.drawsInfoRequestPool.httpRequestSnapshoot(e,t,function(e){f.draws=e,f.isHistoryReady=!0,f.drawPanel.isReady=!0})}};var u=function(i,r){!function(u,d){var h={roomid:u.roomId,userid:u.userId,liveid:u.liveId,upid:u.upId,groupid:u.groupId,recordid:u.recordId,viewertoken:u.viewertoken,viewername:u.viewername,forcibly:u.forcibly},p={globalData:{},requestLoginData:!1,requestInfoData:!1,requestDrawData:!1,requestChatqaData:!1,allRequests:0};o({url:\"//view.csslcloud.net/api/room/replay/login\",data:h,fn:t.on_cc_login_error,done:function(e){if(!_(e,t.on_cc_login_error))return!1;if(e.success){m.drawRequestTime=parseInt(e.datas.drawRequestTime)||1,t.TIMEOUT=t.TIMEOUT+1e3*m.drawRequestTime,y.fastMode||(m.drawRequestTime=\"\"),g.log(\"options\",m),f.state=new l;var a=new l;f.drawsInfoRequestPool=new c(f.state,a)}if(I(p.globalData,e),p.requestLoginData=!0,p.requestInfoData=!1,p.requestDrawData=!1,p.requestChatqaData=!1,p.allRequests++,P(p),\"function\"==typeof t.on_cc_login_success){var i=e.datas,r={type:i.template.type,desc:i.template.desc,name:i.template.name},s={name:i.viewer.name,id:i.viewer.id,groupId:i.viewer.groupId};t.on_cc_login_success({template:r,viewer:s})}m.drawRequestTime||o({url:\"//view.csslcloud.net/api/view/replay/draw/info\",data:h,fn:t.on_cc_request_draw_error,done:function(e){if(!_(e))return!1;I(p.globalData,e),p.requestLoginData=!1,p.requestInfoData=!1,p.requestDrawData=!0,p.requestChatqaData=!1,p.allRequests++,P(p)}}),o({url:\"//view.csslcloud.net/api/view/replay/v2/chatqa/info\",data:h,fn:t.on_cc_request_chatqa_error,done:function(e){if(!_(e,t.on_cc_request_chatqa_error))return!1;I(p.globalData,e),p.requestLoginData=!1,p.requestInfoData=!1,p.requestDrawData=!1,p.requestChatqaData=!0,p.allRequests++,P(p)}}),o({url:\"//view.csslcloud.net/api/view/replay/v2/info\",data:h,fn:t.on_cc_request_info_error,done:function(e){if(!_(e,t.on_cc_request_info_error))return!1;I(p.globalData,e),p.requestLoginData=!1,p.requestInfoData=!0,p.requestDrawData=!1,p.requestChatqaData=!1,p.allRequests++,P(p)}})}});var _=function(e,t){return e.success?!!e.datas:(\"function\"==typeof t&&t(e),!1)},I=function(e,t){b(e,t),e.datas.meta||(e.datas.meta={}),b(e.datas.meta,t.datas.meta)},b=function(e,t){for(var a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(e[a]=t[a])},P=function(o){!function(o){var l=o.globalData;o.requestLoginData&&(y.fastMode&&(e(\"#documentDisplayMode\").val(l.datas.room.documentDisplayMode),y.appendDrawPanel(),y.init()),i.chat={host:l.datas.pusherNode.primary},i.viewer.sessionId=l.datas.sessionId,i.liveId=l.datas.encryptLiveId,i.upId=l.datas.upId,i.viewerId=l.datas.viewer.id,r.socket=new s(i),e.DW.groupId=l.datas.viewer.groupId,\"function\"==typeof t.on_cc_callback_player&&t.on_cc_callback_player(l.datas),i.recordId||(i.recordId=l.datas.encryptRecordId),v.isH5play?q.init(i):\"isMobile\"==q.isMobile()&&q.init(i));var c=l.datas.meta;if(!c)return;if(o.requestInfoData){var u=c.pageChange;if(u){for(var d=0;d<u.length;d++){var h=u[d].url,p=\"https:\"===t.location.protocol;0<h.indexOf(\"//\")&&p&&(h=h.replace(\"http:\",\"https:\"),u[d].url=h)}\"function\"==typeof t.on_cc_callback_pages&&t.on_cc_callback_pages(u)}var g=c.pageChange;g&&g.length&&(g.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.pageChanges=g);var m=c.animation;m&&m.length&&(m.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.animations=m);var _=c.broadcast;if(t.chatLogs=c.broadcast,_&&_.length){_.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var d=0;d<_.length;d++){var I=_[d];\"function\"==typeof t.on_cc_live_broadcast_msg&&t.on_cc_live_broadcast_msg({content:I.content,time:I.time})}r.broadcasts=_}}if(o.requestChatqaData){var b=c.question;if(b&&b.length){b.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.questions=b;for(var d=0;d<r.questions.length;d++){var P=b[d];\"function\"==typeof t.on_cc_live_qa_question&&t.on_cc_live_qa_question({action:\"question\",value:{id:P.encryptId,content:P.content,groupId:P.groupId,userId:P.questionUserId,userName:P.questionUserName,userAvatar:P.questionUserAvatar,isPublish:P.isPublish}})}}var T=c.answer;if(T&&T.length){T.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.answers=T;for(var d=0;d<r.answers.length;d++){var S=T[d];\"function\"==typeof t.on_cc_live_qa_answer&&t.on_cc_live_qa_answer({action:\"answer\",value:{questionId:S.encryptId,content:S.content,userId:S.answerUserId,isPrivate:S.isPrivate,groupId:S.groupId,userName:S.answerUserName,userAvatar:S.answerUserAvatar,userRole:S.answerUserRole}})}}var k=c.chatLog;if(t.chatLogs=c.chatLog,k&&k.length){k.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var d=0;d<k.length;d++){var D=k[d];\"function\"==typeof t.on_cc_live_chat_msg&&t.on_cc_live_chat_msg({userid:D.userId,username:D.userName,time:D.time,msg:D.content,groupId:D.groupId,chatId:D.chatId,status:D.status,useravatar:D.userAvatar,userRole:D.userRole,usercustommark:D.userCustomMark,role:D.role})}r.chatLogs=k}t.chatLogs&&t.chatLogs.length&&(t.CHATLOGS=t.chatLogs,setInterval(function(){var a=0;try{a=parseInt(e(\"#playbackVideo\")[0].currentTime,10)}catch(a){}if(!(a<=0)&&t.CHATLOGS.length)for(var i=t.CHATLOGS[0];i.time<=a;){var r=t.CHATLOGS.shift();if(f.chatMessageCache.push({userid:r.userId,username:r.userName,time:r.time,msg:r.content,groupId:r.groupId,useravatar:r.userAvatar,userRole:r.userRole,chatId:i.chatId,status:i.status,usercustommark:r.userCustomMark,role:r.role}),!t.CHATLOGS.length)break;i=t.CHATLOGS[0]}},1e3)),t.broadcasts&&t.broadcasts.length&&(t.BROADCASTS=t.broadcasts,setInterval(function(){var a=0;try{a=parseInt(e(\"#playbackVideo\")[0].currentTime,10)}catch(a){}if(!(a<=0)&&t.BROADCASTS.length)for(var i=t.BROADCASTS[0];i.time<=a;){var r=t.BROADCASTS.shift();if(f.broadcastCache.push({content:r.content,time:r.time}),!t.BROADCASTS.length)break;i=t.BROADCASTS[0]}},1e3))}if(o.requestDrawData){var R=c.draw;R&&R.length&&(r.draws=R),r.isHistoryReady=!0,r.drawPanel.isReady=!0,setTimeout(function(){w()},1500)}t.on_cc_h5_player_load=function(){if(r.callbackPlayer.isReady=!0,!n){n=!0;var t=a.getElementById(\"drawPanel\");t&&e.Callback.config({playerId:\"playbackVideo\"},c)}}}(o)}}(i);var n=!1},d=function(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){f.broadcastCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],a=Math.min(this.cache.length,10),i=0;i<a;i++)e.push(this.cache.shift());\"function\"==typeof t.on_cc_live_broadcast_msg_sync&&t.on_cc_live_broadcast_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){f.broadcastCache.refresh()},80)}}},h=function(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){f.chatMessageCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],a=Math.min(this.cache.length,10),i=0;i<a;i++)e.push(this.cache.shift());\"function\"==typeof t.on_cc_live_chat_msg_sync&&t.on_cc_live_chat_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){f.chatMessageCache.refresh()},80)}}},p=function(e){this.chatLogs=[],this.broadcasts=[],this.draws=[],this.pageChanges=[],this.isHistoryReady=!1,this.questions=[],this.answers=[],this.pageChanges=[],this.draws=[],this.animations=[],this.pageChangeIndex=-1,this.drawIndex=-1,this.animationIndex=-1,this.isRequestDraws=!1,this.drawPanel=new n(e,this),this.history=new u(e,this),this.chatMessageCache=new h,this.broadcastCache=new d},f={};t.debug=!1;var g={debug:t.debug,log:function(e,a){t.debug&&(a?console.log(e+\" => \",a):console.log(e))}};t.TIMEOUT=5e3;var m={userId:e(\"#userId\").val(),roomId:e(\"#roomId\").val(),liveId:e(\"#liveId\").val(),recordId:e(\"#recordId\").val(),videoId:e(\"#videoId\").val(),adapt:!1,isShowBar:0,viewerId:e(\"#viewerId\").val(),upId:e(\"#upId\").val(),viewer:{id:e(\"#viewerId\").val(),name:e(\"#viewerName\").val(),role:e(\"#viewerRole\").val(),sessionId:e(\"#sessionId\").val()},callbackPlayer:{id:\"playbackPlayer\",width:\"100%\",height:\"100%\"},drawPanel:{id:\"playbackPanel\",width:\"100%\",height:\"100%\"}},y={dpc:{},fastMode:!1,init:function(){this.dpc=new Dpc},appendDrawPanel:function(){var a='<iframe id=\"dpa\" allow-scripts allowfullscreen allowusermedia frameborder=\"0\" style=\"width: 100%;height:100%;\"></iframe>';\"isMobile\"==q.isMobile()&&(a='<iframe id=\"dpa\" allow-scripts allowfullscreen allowusermedia frameborder=\"0\" style=\"width: 100%;height:100%;pointer-events: none;\"></iframe>'),e(\"#playbackPanel\").parent().append(a),e(\"div#playbackPanel\").remove(),\"function\"==typeof t.on_cc_live_db_flip&&t.on_cc_live_db_flip()},pageChange:function(e){this.fastMode&&this.dpc.pageChange(e)},animationChange:function(e){this.fastMode&&this.dpc.animationChange(e)},history:function(e){this.fastMode&&this.dpc.history(e)},draw:function(e){this.fastMode&&this.dpc.draw(e)},clear:function(){this.fastMode&&this.dpc.clear()},docAdapt:function(e){if(this.fastMode){var t=e?\"1\":\"2\";this.dpc.setDisplayMode(t)}}},v={isH5play:!1,fastMode:!1,forceNew:!1,setFastMode:function(e){\"string\"==typeof e.fastMode?\"false\"===e.fastMode?this.fastMode=!1:this.fastMode=!0:\"boolean\"==typeof e.fastMode?this.fastMode=e.fastMode:this.fastMode=!1},config:function(t){(function(){if(a.createElement(\"video\").canPlayType){var e=a.createElement(\"video\");return oggTest=e.canPlayType('video/ogg; codecs=\"theora, vorbis\"'),oggTest?\"probably\"==oggTest:(h264Test=e.canPlayType('video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"'),!!h264Test&&\"probably\"==h264Test)}return!1})()&&(t.isH5play+\"\"==\"true\"?this.isH5play=!0:this.isH5play=!1),this.setFastMode(t),y.fastMode=this.fastMode;var i=[\"//static.csslcloud.net/js/socket.io.js\",\"//static.csslcloud.net/js/swfobject.js\",\"//image.csslcloud.net/js/dpc.js?v=20180121\",\"//static.csslcloud.net/js/json3.min.js\",\"//static.csslcloud.net/js/module/drawingBoard-2.0.0.js\",\"//static.csslcloud.net/js/module/drawingBoardPlayback.js\",\"//static.csslcloud.net/js/report.js\"];y.fastMode&&i.splice(3,2),this.loadScript(i,function(){var a;a=t,m.viewerId=a.viewerid,m=e.extend(m,a),f=new p(m),\"isMobile\"==q.isMobile()&&e.DrawingBoard&&!y.fastMode&&v.appendDrawPanel()}),\"boolean\"==typeof t.forceNew&&(this.forceNew=t.forceNew)},appendDrawPanel:function(){e(\"#playbackPanel\").parent().append('<canvas id=\"drawPanel\" width=\"1200\" height=\"1200\" style=\"position: absolute;z-index:2;top:0;left: 0\"></canvas><iframe id=\"dpa\" src=\"\" frameborder=\"0\" style=\"position: absolute;top:0;left: 0\"></iframe>'),e(\"div#playbackPanel\").remove()},logout:function(){e.ajax({url:\"//view.csslcloud.net/api/callback/logout\",type:\"GET\",dataType:\"json\",timeout:5e3,xhrFields:{withCredentials:!0},success:function(e){},error:function(e,t,a){}})},getScript:function(e,t){var i=!1,r=a.createElement(\"script\");r.src=e,r.onload=r.onreadystatechange=function(){i||this.readyState&&\"loaded\"!=this.readyState&&\"complete\"!=this.readyState||(i=!0,t&&t())},a.body.appendChild(r)},loadScript:function(e,t){if(\"string\"==typeof e){var a=e;(e=[]).push(a)}var i=this;!function e(t,a){i.getScript(t.shift(),function(){t.length?e(t,a):a&&a()})}(e,t)},playbackRate:function(e){f.callbackPlayer.playbackRate(e)},seek:function(e){clearInterval(f.drawPanel.intervalNum),f.callbackPlayer.seek(e)},getPlayerTime:function(){return f.callbackPlayer.getPlayerTime()},getDuration:function(){return v.isH5play?q.getDuration():\"isMobile\"==q.isMobile()?q.getDuration():f.callbackPlayer.getDuration()},docAdapt:function(e){y.fastMode&&y.docAdapt(e),m.adapt=e},isShowBar:function(e){m.isShowBar=e},getBuffer:function(){return f.callbackPlayer.getBuffer()},setVolume:function(e){return f.callbackPlayer.setVolume(e)},getVolume:function(){return f.callbackPlayer.getVolume()},play:function(){return f.callbackPlayer.play()},setZScale:function(e){return f.callbackPlayer.setZScale(e)},getZScale:function(){return f.callbackPlayer.getZScale()},setScale:function(e){return f.callbackPlayer.setScale(e)},getScale:function(){return f.callbackPlayer.getScale()},openSettingPanel:function(){return f.callbackPlayer.openSettingPanel()}};function w(){f.isHistoryReady?function e(){f.callbackPlayer.isReady?f.drawPanel.intervalPainting(f):setTimeout(function(){e()},500)}():setTimeout(function(){w()},300)}e.extend({DW:v}),t.on_cc_callback_player=function(e){m.videoId=e.live.encryptRecordvideoId,m.recordId=e.encryptRecordId,f.callbackPlayer=new r(m)},t.on_cc_live_player_init=function(){f.callbackPlayer.isReady=!0;try{f.callbackPlayer.getFlash().start()}catch(e){}setInterval(function(){var e=0;try{e=f.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&f.chatLogs.length)for(var t=f.chatLogs[0];t.time<=e&&(t=f.chatLogs.shift(),f.chatMessageCache.push({userid:t.userId,username:t.userName,time:t.time,msg:t.content,groupId:t.groupId,chatId:t.chatId,status:t.status,useravatar:t.userAvatar,userRole:t.userRole,usercustommark:t.userCustomMark,role:t.role}),f.chatLogs.length);)t=f.chatLogs[0]},1e3),setInterval(function(){var e=0;try{e=f.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&f.broadcasts.length)for(var t=f.broadcasts[0];t.time<=e&&(t=f.broadcasts.shift(),f.broadcastCache.push({content:t.content,time:t.time}),f.broadcasts.length);)t=f.broadcasts[0]},1e3),\"function\"==typeof t.on_cc_live_player_load&&t.on_cc_live_player_load(),on_cc_limit_request_draws&&(parseInt(f.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},t.on_drampanel_ready=function(){f.drawPanel.isReady=!0,setTimeout(function(){w()},1500)},t.seekStart=function(){clearInterval(f.drawPanel.intervalNum)},t.seekComplete=function(){f.drawPanel.clear();var e=f.callbackPlayer.getPlayerTime();e<0&&(e=0),f.pageChangeIndex=-1,f.drawIndex=-1,f.animationIndex=-1;var a={pageChange:[],animation:[],draw:[]};if(f.pageChanges&&0<f.pageChanges.length){for(var i=0;i<f.pageChanges.length;i++)e>=(r=f.pageChanges[i]).time&&(f.pageChangeIndex=i);if(0<=f.pageChangeIndex){var r=f.pageChanges[f.pageChangeIndex];\"function\"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(r),\"function\"==typeof t.on_cc_request_snapshoot&&t.on_cc_request_snapshoot(r),f.drawPanel.filp(JSON.stringify({fileName:r.docName,totalPage:r.docTotalPage,docid:r.encryptDocId,url:r.url,page:r.pageNum,useSDK:r.useSDK})),a.pageChange.push(r)}}if(f.animations&&0<f.animations.length){for(i=0;i<f.animations.length;i++)e>=(n=f.animations[i]).time&&(f.animationIndex=i);if(0<=f.animationIndex){var s=f.pageChangeIndex;if(0<=s){r=f.pageChanges[s];var n=f.animations[f.animationIndex];r&&n&&r.encryptDocId==n.encryptDocId&&e>=n.time&&r.time<=n.time&&(f.drawPanel.animation(JSON.stringify({fileName:n.docName,totalPage:n.docTotalPage,docid:n.encryptDocId,url:n.url,page:n.pageNum,step:n.step})),a.animation.push(n))}}}if(f.draws&&0<f.draws.length){for(i=0;i<f.draws.length;i++)(c=f.draws[i])&&e>=c.time&&(f.drawIndex=i);var o=f.draws.slice(0,f.drawIndex+1);if(0<o.length){var l=[];for(i=0;i<o.length;i++){var c=o[i];l.push(c.data),a.draw.push(c)}f.drawPanel.draws(l)}}y.history(a),f.drawPanel.intervalNum=setInterval(function(){f.drawPanel.interval()},1e3)};var _={addEvents:function(e,t,i){a.addEventListener?_.addEvents=function(e,t,a){e.addEventListener(t,a,!1)}:_.addEvents=function(e,t,a){e.attachEvent(\"on\"+t,function(){a.call(e,arguments)})},_.addEvents(e,t,i)}},I=0,b=0,P=!0,q={pauseState:!1,init:function(a){var i=this;e.ajax({url:\"//view.csslcloud.net/api/vod/v2/play/h5\",type:\"GET\",dataType:\"jsonp\",data:{userid:a.userId,roomid:a.roomId,recordid:a.recordId},success:function(e){var r=e.video[0],s=r.playurl,n=r.secureplayurl;\"https:\"===t.location.protocol&&n&&(s=n),i.appendVideo(s,a)}})},appendVideo:function(i,r){var s=this,n='<video id=\"playbackVideo\" webkit-playsinline playsinline controls autoplay x-webkit-airplay=\"deny\" x5-playsinline width=\"100%\" height=\"100%\" src=\"'+i+'\"></video>';e(\"#\"+playbackPlayer.id).html(n);var o=a.getElementById(\"playbackVideo\");r.isShowBar&&o.removeAttribute(\"controls\");var l=0,c=1;\"isMobile\"==q.isMobile()&&(l=1,c=11),new ReportLog(r,l,c,o,!1),this.isAndroid()||(this.pauseState=!0),_.addEvents(o,\"canplay\",function(){\"isMobile\"==q.isMobile()?(t.on_cc_live_player_load&&t.on_cc_live_player_load(),t.on_cc_h5_player_load&&t.on_cc_h5_player_load()):v.isH5play&&t.on_cc_live_player_init&&t.on_cc_live_player_init(),on_cc_limit_request_draws&&(parseInt(f.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},!1),_.addEvents(o,\"playing\",function(){s.pauseState=!1,t.on_player_start&&on_player_start(),t.on_spark_player_resume&&on_spark_player_resume()},!1),_.addEvents(o,\"pause\",function(){s.pauseState=!0,t.on_spark_player_pause&&on_spark_player_pause()},!1),_.addEvents(o,\"ended\",function(){t.on_spark_player_end&&on_spark_player_end()},!1),_.addEvents(o,\"seeking\",function(){P=!1,seekStart&&seekStart()},!1),_.addEvents(o,\"seeked\",function(){P=!1,seekComplete&&seekComplete()},!1)},getDuration:function(){var e=a.getElementById(\"playbackVideo\");if(e)return Math.floor(e.duration)},getPlayerTime:function(){var e=a.getElementById(\"playbackVideo\");if(e)return Math.floor(e.currentTime)},end:function(){e(\"#\"+playbackPlayer.id).html(\"end\")},appendDoc:function(t){var a='<img src=\"'+t+'\" />';e(\"#\"+playbackPanel.id).append(a)},isMobile:function(){if(this.isIPad()||this.isIPhone()||this.isAndroid()||this.isWindowsPhone())return\"isMobile\"},isIPad:function(){return null!=navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!=navigator.userAgent.match(/iPhone/i)},isAndroid:function(){return null!=navigator.userAgent.match(/Android/i)},isWindowsPhone:function(){return null!=navigator.userAgent.match(/Windows Phone/i)}}}(jQuery,window,document)}});","extractedComments":[]}