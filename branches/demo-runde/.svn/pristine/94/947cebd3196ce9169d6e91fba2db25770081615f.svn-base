{"code":"!function(e){var t={};function a(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var s in e)a.d(i,s,function(t){return e[t]}.bind(null,s));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,\"a\",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p=\"\",a(a.s=1)}([,function(e,t){!function(e,t,a){function i(t){this.isReady=!1,this.isPublishing=0,this.id=t.callbackPlayer.id;var a={userid:t.userId,videoid:t.videoId,recordid:t.recordId,isShowBar:t.isShowBar,upid:t.upId,viewerid:t.viewerId,roomid:t.roomId,ua:\"1\"},i={allowFullscreen:\"true\",allowScriptAccess:\"always\",wmode:\"transparent\"};this.flashPlayerInit=function(){swfobject.embedSWF(\"//player.csslcloud.net/platform/live/CallbackPlayer.swf\",t.callbackPlayer.id,t.callbackPlayer.width,t.callbackPlayer.height,\"10.0.0\",\"/flash/expressInstall.swf\",a,i),\"isMobile\"!=P.isMobile()&&new ReportLog(t,0,1,null,!1)},y.isH5play||this.flashPlayerInit(),this.getFlash=function(){return swfobject.getObjectById(this.id)},this.playbackRate=function(e){(y.isH5play||\"isMobile\"===P.isMobile())&&(e=parseFloat(e),this.getH5player().playbackRate=e)},this.seek=function(e){if(!(e<0))if(y.isH5play||\"isMobile\"==P.isMobile())this.getH5player().currentTime=e;else{var t=this.getFlash();if(!t)return;t.seek(e)}},this.getFlash=function(){return swfobject.getObjectById(this.id)},this.getH5player=function(){return e(\"#playbackVideo\")[0]},this.getPlayerTime=function(){return this.isReady?(e=y.isH5play||\"isMobile\"==P.isMobile()?this.getH5player().currentTime:parseInt(this.getFlash().getPosition(),10),isNaN(e)||e<0?0:e):0;var e},this.getDuration=function(){if(y.isH5play||\"isMobile\"==P.isMobile())return this.getH5player().duration;var e=this.getFlash();return e?e.getDuration():void 0},this.getBuffer=function(){if(y.isH5play||\"isMobile\"==P.isMobile())return this.getH5player()&&this.getH5player().buffered&&this.getH5player().buffered.end(0)?this.getH5player().buffered.end(0):0;var e=this.getFlash();return e?e.getBufferLength():void 0},this.setVolume=function(e){if(!y.isH5play&&\"isMobile\"!=P.isMobile()){var t=this.getFlash();if(!t)return;return t.setVolume(e)}this.getH5player().volume=parseFloat(e)},this.getVolume=function(){if(y.isH5play||\"isMobile\"==P.isMobile())return this.getH5player().volume;var e=this.getFlash();return e?e.getVolume():void 0},this.play=function(){if(!y.isH5play&&\"isMobile\"!=P.isMobile()){var e=this.getFlash();if(!e)return;return e.isPlay()}P.pauseState?this.getH5player().play():this.getH5player().pause()},this.setZScale=function(e){var t=this.getFlash();if(t)return t.setZScale(e)},this.getZScale=function(){var e=this.getFlash();if(e)return e.getZScale()},this.setScale=function(e){var t=this.getFlash();if(t)return t.setScale(e)},this.getScale=function(){var e=this.getFlash();if(e)return e.getScale()},this.openSettingPanel=function(){var e=this.getFlash();if(e)return e.openSettingPanel()}}function s(e){var i=\"https:\"===t.location.protocol,s=e.chat.host;if(i&&s&&s.indexOf(\":\")){var r=s.split(\":\");if(2==r.length){var n=parseInt(r[1]);if(!isNaN(n)){var o=n+400;s=r[0]+\":\"+o}}}var l=0;\"isMobile\"==P.isMobile()&&(l=1),y.forceNew?(io.connect(a.location.protocol+\"//\"+s+\"/replay?roomid=\"+e.roomId+\"&sessionid=\"+e.viewer.sessionId+\"&platform=1&terminal=\"+l,{forceNew:!0}),f.log(\"{forceNew: true}\")):(io.connect(a.location.protocol+\"//\"+s+\"/replay\",{query:{roomid:e.roomId,sessionid:e.viewer.sessionId,platform:1,terminal:l}}),f.log(\"{forceNew: false}\"))}function r(e,a){this.isReady=!1,m.fastMode||swfobject.embedSWF(\"//zeus.csslcloud.net/flash/Player.swf\",e.drawPanel.id,e.drawPanel.width,e.drawPanel.height,\"10.0.0\",\"/flash/expressInstall.swf\",{type:\"drawpanel\"},{allowFullscreen:\"true\",allowScriptAccess:\"always\",wmode:\"transparent\"},{}),this.getFlash=function(){if(this.isReady)return swfobject.getObjectById(e.drawPanel.id)},this.clear=function(){m.clear();var e=this.getFlash();e&&e.clear()},this.draw=function(e){m.draw(e);var t=this.getFlash();t&&t.draw(e)},this.draws=function(e){var t,a=this.getFlash();a&&(t=e,setTimeout(function(){a.drawList(t)}))},this.filp=function(e){m.pageChange(e);var a=this.getFlash();if(a){var i=JSON.parse(e),s=i.url;\"https:\"===t.location.protocol&&(i.url=s.replace(/http:/g,\"https:\")),g.adapt?a.filp(JSON.stringify(i),\"auto\"):a.filp(JSON.stringify(i))}},this.animation=function(e){m.animationChange(e);var t=this.getFlash();t&&t.animation(e)},this.intervalNum=0,this.interval=function(){var e=0;try{e=p.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<0)){b&&(I=e,2.5<=Math.abs(I-_)&&seekComplete&&seekComplete(),_=e),p.isRequestDraws&&p.drawsInfoRequestPool.isHttpRequestCurrentDraws(e,function(e){p.draws=e});try{if(p.animations&&0<p.animations.length&&p.animationIndex<p.animations.length&&0<=(r=p.pageChangeIndex)){var a=p.pageChanges[r],i=p.animations[p.animationIndex+1];a&&i&&a.encryptDocId==i.encryptDocId&&e>=i.time&&a.time<=i.time&&(m.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),p.animationIndex=p.animationIndex+1)}}catch(e){}try{if(p.pageChanges&&0<p.pageChanges.length&&p.pageChangeIndex<p.pageChanges.length&&e>=(a=p.pageChanges[p.pageChangeIndex+1]).time){\"function\"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(a),\"function\"==typeof t.on_cc_request_snapshoot&&t.on_cc_request_snapshoot(a),m.fastMode?this.filp(a):this.filp(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,useSDK:a.useSDK})),p.pageChangeIndex=p.pageChangeIndex+1;var s={};s.docId=a.docId,s.docName=a.docName,s.docTotalPage=a.docTotalPage,s.pageNum=a.pageNum,\"function\"==typeof t.on_cc_callback_pagechange&&t.on_cc_callback_pagechange(s)}}catch(e){}try{var r;p.animations&&0<p.animations.length&&p.animationIndex<p.animations.length&&0<=(r=p.pageChangeIndex)&&(a=p.pageChanges[r],i=p.animations[p.animationIndex+1],a&&i&&a.encryptDocId==i.encryptDocId&&e>=i.time&&a.time<=i.time&&(m.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),p.animationIndex=p.animationIndex+1))}catch(e){}try{if(p.draws&&0<p.draws.length&&p.drawIndex<p.draws.length)for(var n=p.draws[p.drawIndex+1];e>=n.time;)m.fastMode?this.draw(n):this.draw(n.data),p.drawIndex=p.drawIndex+1,n=p.draws[p.drawIndex+1]}catch(e){}}},this.intervalPainting=function(e){e.drawPanel.intervalNum=setInterval(function(){e.drawPanel.interval(e)},1e3)}}function n(t){e.ajax({url:t.url,type:\"GET\",data:t.data,tryCount:0,retryLimit:3,timeout:5e3,dataType:\"jsonp\",success:function(e){t.done(e)},error:function(a,i,s){if(\"timeout\"==i)return this.tryCount++,this.tryCount<this.retryLimit?void e.ajax(this):void(\"function\"==typeof t.fn&&t.fn(i));a.status}})}var o=function(){this.requestState=!1,this.result=0,this.startTime=0,this.endTime=0,this.key=0,this.index=0,this.ajax={},this.states=[],this.snapshoot=[],this.drawsAlready=0,this.roomId=g.roomId,this.userId=g.userId,this.recordId=g.recordId,this.liveId=g.liveId,this.drawRequestTime=g.drawRequestTime,this.setSnapshoot=function(e,t){this.snapshoot[e]=t},this.getSnapshoot=function(){return this.snapshoot},this.init=function(e){for(var t=0;t<this.drawRequestTime;t++){var a={requestState:!1,result:0,startTime:e.startTime,endTime:e.endTime,key:t};e.startTime=e.startTime+e.blockTime,e.endTime=e.startTime+e.blockTime,this.setState(a)}},this.httpRequest=function(a,i){var s=this;s.requestState=!0,this.ajax=e.ajax({url:a.url,type:\"GET\",data:a.param,tryCount:0,retryLimit:3,timeout:t.TIMEOUT,dataType:\"jsonp\",success:function(e){(s.result=e).success?(i(e),s.requestState=!1):f.log(\"data.success\",e.success)},error:function(t,a,i){if(\"timeout\"==a)return this.tryCount++,this.tryCount<this.retryLimit?(e.ajax(this),void f.log(\"ajax[\"+s.key+\"] try again tryCount\",this.tryCount)):(f.log(\"数据请求失败且重试多次\"),void(s.requestState=!1));t.status}})},this.abort=function(){this.ajax.abort(),this.requestState=!1},this.setState=function(e){if(\"object\"==typeof e){var t=e.key||this.index++;e.key&&!isNaN(e.key)&&(this.index=parseInt(e.key)+1);var a=new o;a.requestState=e.requestState||this.requestState,a.result=e.result||this.result,a.startTime=e.startTime||this.startTime,a.endTime=e.endTime||this.endTime,a.ajax=e.ajax||this.ajax,a.snapshoot=e.snapshoot||this.snapshoot,a.key=t,this.states[t]=a}},this.getState=function(e){return this.states[e]},this.getStates=function(){return this.states},this.getCurrentStateIndex=function(e){for(var t=0,a=0;a<this.states.length;a++)if(e>this.states[a].startTime&&e<=this.states[a].endTime){t=a;break}return t},this.isDrawsAlready=function(){return parseInt(this.drawRequestTime,10)===parseInt(this.drawsAlready,10)}},l=function(e,t){function a(e,t){var a=e.concat(t),i=[],s={};for(var r in a)s[JSON.stringify(a[r])]||(i.push(a[r]),s[JSON.stringify(a[r])]=1);return i}this.state=e,this.requestNumber=2,this.httpRequestPool=[],this.draws=[],this.preState={},this.isHttpRequestCurrentDraws=function(t,a){if(e.drawRequestTime){var i=e.isDrawsAlready();if(i)f.log(\"画笔数据加载完毕，不在预加载某一段数据\");else{var s=e.getStates(),r=e.getCurrentStateIndex(t),n=s[r];if(this.preState!=n&&this.preState.requestState&&(f.log(\"发现新的预加载请求，中断上一个预加载请求;index=\"+this.preState.key),this.preState.abort()),this.preState=n,i||n.result||n.requestState)f.log(\"预加载过这段数据或已有数据;index=\"+r);else{f.log(\"预加载数据\",r);var o={index:r,states:s};this.httpRequestCurrentDraws(o,a)}}}},this.httpRequestCurrentDraws=function(e,t){var i=this,s=e.states,r=e.index,n=s[r],o={url:\"//view.csslcloud.net/api/view/replay/v2/draw/range\",param:{starttime:n.startTime,endtime:n.endTime,userid:n.userId,recordid:n.recordId,liveid:n.liveId}};n.httpRequest(o,function(e){var s=e.datas.meta.draw;f.log(\"*** 预加载成功 callback.draws[\"+r+\"] ***\",s),i.draws=a(i.draws,s),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),t(i.draws),p.state.drawsAlready++})},this.httpRequestStream=function(e){var i=this;if(i.state.isDrawsAlready())return f.log(\"httpRequestStream draws already\",i.draws),f.log(\"callback.state\",p.state),void f.log(\"snapshoot\",t);for(var s=i.state.getStates(),r=0;r<s.length;r++)if(!(o=s[r]).result&&!o.requestState){if(!(i.httpRequestPool.length<i.requestNumber))break;i.httpRequestPool.push(o)}for(var n=0;n<i.httpRequestPool.length;n++){var o;(o=i.httpRequestPool[n]).result||o.requestState||function(t){var s={url:\"//view.csslcloud.net/api/view/replay/v2/draw/range\",param:{starttime:t.startTime,endtime:t.endTime,userid:t.userId,recordid:t.recordId,liveid:t.liveId}};t.httpRequest(s,function(s){var r=s.datas.meta.draw;f.log(\"请求流 draw[\"+t.key+\"]\",r),p.isRequestDraws?i.draws=a(i.draws,r):i.draws=i.draws.concat(r),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),e(i.draws);for(var n=0;n<i.httpRequestPool.length;n++)if(i.httpRequestPool[n].key==t.key){i.httpRequestPool.splice(n,1);break}p.state.drawsAlready++,i.httpRequestStream(e)})}(o)}},this.httpRequestSnapshoot=function(i,s,r){var n=this;if(e.isDrawsAlready())f.log(\"画笔数据请求完整，不在请求快照数据\");else{var o=e.getStates(),l=(s=s,e.getCurrentStateIndex(s)),c=o[l];if(c){var d=t.getSnapshoot(),u=d[i.docId+\"_\"+i.pageNum+\"_\"+i.url];if(c.result||u)f.log(\"当前时间段存在数据或存在快照\",l+\"\");else{f.log(\"_snapshoot.getSnapshoot()\",d),t.requestState&&t.abort();var h={url:\"//view.csslcloud.net/api/view/replay/v2/draw/snapshot\",param:{docid:i.docId,currentpage:i.pageNum,userid:t.userId,recordid:t.recordId}};t.httpRequest(h,function(e){if(t.setSnapshoot(i.docId+\"_\"+i.pageNum+\"_\"+i.url,e),c.result)f.log(\"快照请求成功，当前时间段数据存在，丢弃快照\"+l);else{p.isRequestDraws=!0;var s=e.datas.meta.draw;f.log(\"*** 快照 callback.draws[\"+i.docId+\"_\"+i.pageNum+\"_\"+i.url+\"] ***\",s),n.draws=a(n.draws,s),n.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r(n.draws)}})}}}}};function c(i,r){!function(d,u){var h={roomid:d.roomId,userid:d.userId,liveid:d.liveId,upid:d.upId,groupid:d.groupId,recordid:d.recordId,viewertoken:d.viewertoken,viewername:d.viewername,forcibly:d.forcibly},w={globalData:{},requestLoginData:!1,requestInfoData:!1,requestDrawData:!1,requestChatqaData:!1,allRequests:0};n({url:\"//view.csslcloud.net/api/room/replay/login\",data:h,fn:t.on_cc_login_error,done:function(e){if(!_(e,t.on_cc_login_error))return!1;if(e.success){g.drawRequestTime=parseInt(e.datas.drawRequestTime)||1,t.TIMEOUT=t.TIMEOUT+1e3*g.drawRequestTime,m.fastMode||(g.drawRequestTime=\"\"),f.log(\"options\",g),p.state=new o;var a=new o;p.drawsInfoRequestPool=new l(p.state,a)}if(I(w.globalData,e),w.requestLoginData=!0,w.requestInfoData=!1,w.requestDrawData=!1,w.requestChatqaData=!1,w.allRequests++,q(w),\"function\"==typeof t.on_cc_login_success){var i=e.datas,s={type:i.template.type,desc:i.template.desc,name:i.template.name},r={name:i.viewer.name,id:i.viewer.id,groupId:i.viewer.groupId};t.on_cc_login_success({template:s,viewer:r})}g.drawRequestTime||n({url:\"//view.csslcloud.net/api/view/replay/draw/info\",data:h,fn:t.on_cc_request_draw_error,done:function(e){if(!_(e))return!1;I(w.globalData,e),w.requestLoginData=!1,w.requestInfoData=!1,w.requestDrawData=!0,w.requestChatqaData=!1,w.allRequests++,q(w)}}),n({url:\"//view.csslcloud.net/api/view/replay/v2/chatqa/info\",data:h,fn:t.on_cc_request_chatqa_error,done:function(e){if(!_(e,t.on_cc_request_chatqa_error))return!1;I(w.globalData,e),w.requestLoginData=!1,w.requestInfoData=!1,w.requestDrawData=!1,w.requestChatqaData=!0,w.allRequests++,q(w)}}),n({url:\"//view.csslcloud.net/api/view/replay/v2/info\",data:h,fn:t.on_cc_request_info_error,done:function(e){if(!_(e,t.on_cc_request_info_error))return!1;I(w.globalData,e),w.requestLoginData=!1,w.requestInfoData=!0,w.requestDrawData=!1,w.requestChatqaData=!1,w.allRequests++,q(w)}})}});var _=function(e,t){return e.success?!!e.datas:(\"function\"==typeof t&&t(e),!1)},I=function(e,t){b(e,t),e.datas.meta||(e.datas.meta={}),b(e.datas.meta,t.datas.meta)},b=function(e,t){for(var a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(e[a]=t[a])},q=function(n){!function(n){var o=n.globalData;n.requestLoginData&&(m.fastMode&&(e(\"#documentDisplayMode\").val(o.datas.room.documentDisplayMode),m.appendDrawPanel(),m.init()),i.chat={host:o.datas.pusherNode.primary},i.viewer.sessionId=o.datas.sessionId,i.liveId=o.datas.encryptLiveId,i.upId=o.datas.upId,i.viewerId=o.datas.viewer.id,r.socket=new s(i),e.DW.groupId=o.datas.viewer.groupId,\"function\"==typeof t.on_cc_callback_player&&t.on_cc_callback_player(o.datas),i.recordId||(i.recordId=o.datas.encryptRecordId),y.isH5play?P.init(i):\"isMobile\"==P.isMobile()&&P.init(i));var l=o.datas.meta;if(!l)return;if(n.requestInfoData){var d=l.pageChange;if(d){for(var u=0;u<d.length;u++){var h=d[u].url,f=\"https:\"===t.location.protocol;0<h.indexOf(\"//\")&&f&&(h=h.replace(\"http:\",\"https:\"),d[u].url=h)}\"function\"==typeof t.on_cc_callback_pages&&t.on_cc_callback_pages(d)}var g=l.pageChange;g&&g.length&&(g.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.pageChanges=g);var w=l.animation;w&&w.length&&(w.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.animations=w);var _=l.broadcast;if(t.chatLogs=l.broadcast,_&&_.length){_.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var u=0;u<_.length;u++){var I=_[u];\"function\"==typeof t.on_cc_live_broadcast_msg&&t.on_cc_live_broadcast_msg({content:I.content,time:I.time})}r.broadcasts=_}}if(n.requestChatqaData){var b=l.question;if(b&&b.length){b.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.questions=b;for(var u=0;u<r.questions.length;u++){var q=b[u];\"function\"==typeof t.on_cc_live_qa_question&&t.on_cc_live_qa_question({action:\"question\",value:{id:q.encryptId,content:q.content,groupId:q.groupId,userId:q.questionUserId,userName:q.questionUserName,userAvatar:q.questionUserAvatar,isPublish:q.isPublish}})}}var T=l.answer;if(T&&T.length){T.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.answers=T;for(var u=0;u<r.answers.length;u++){var k=T[u];\"function\"==typeof t.on_cc_live_qa_answer&&t.on_cc_live_qa_answer({action:\"answer\",value:{questionId:k.encryptId,content:k.content,userId:k.answerUserId,isPrivate:k.isPrivate,groupId:k.groupId,userName:k.answerUserName,userAvatar:k.answerUserAvatar,userRole:k.answerUserRole}})}}var S=l.chatLog;if(t.chatLogs=l.chatLog,S&&S.length){S.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var u=0;u<S.length;u++){var D=S[u];\"function\"==typeof t.on_cc_live_chat_msg&&t.on_cc_live_chat_msg({userid:D.userId,username:D.userName,time:D.time,msg:D.content,groupId:D.groupId,chatId:D.chatId,status:D.status,useravatar:D.userAvatar,userRole:D.userRole,usercustommark:D.userCustomMark,role:D.role})}r.chatLogs=S}t.chatLogs&&t.chatLogs.length&&(t.CHATLOGS=t.chatLogs,setInterval(function(){var a=0;try{a=parseInt(e(\"#playbackVideo\")[0].currentTime,10)}catch(a){}if(!(a<=0)&&t.CHATLOGS.length)for(var i=t.CHATLOGS[0];i.time<=a;){var s=t.CHATLOGS.shift();if(p.chatMessageCache.push({userid:s.userId,username:s.userName,time:s.time,msg:s.content,groupId:s.groupId,useravatar:s.userAvatar,userRole:s.userRole,chatId:i.chatId,status:i.status,usercustommark:s.userCustomMark,role:s.role}),!t.CHATLOGS.length)break;i=t.CHATLOGS[0]}},1e3)),t.broadcasts&&t.broadcasts.length&&(t.BROADCASTS=t.broadcasts,setInterval(function(){var a=0;try{a=parseInt(e(\"#playbackVideo\")[0].currentTime,10)}catch(a){}if(!(a<=0)&&t.BROADCASTS.length)for(var i=t.BROADCASTS[0];i.time<=a;){var s=t.BROADCASTS.shift();if(p.broadcastCache.push({content:s.content,time:s.time}),!t.BROADCASTS.length)break;i=t.BROADCASTS[0]}},1e3))}if(n.requestDrawData){var R=l.draw;R&&R.length&&(r.draws=R),r.isHistoryReady=!0,r.drawPanel.isReady=!0,setTimeout(function(){v()},1500)}t.on_cc_h5_player_load=function(){if(r.callbackPlayer.isReady=!0,!c){c=!0;var t=a.getElementById(\"drawPanel\");t&&e.Callback.config({playerId:\"playbackVideo\"},l)}}}(n)}}(i);var c=!1}function d(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){p.broadcastCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],a=Math.min(this.cache.length,10),i=0;i<a;i++)e.push(this.cache.shift());\"function\"==typeof t.on_cc_live_broadcast_msg_sync&&t.on_cc_live_broadcast_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){p.broadcastCache.refresh()},80)}}}function u(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){p.chatMessageCache.refresh()},80),this.push=function(e){5e3<this.cache.length||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&80<=e-this.lastTimeRefresh},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],a=Math.min(this.cache.length,10),i=0;i<a;i++)e.push(this.cache.shift());\"function\"==typeof t.on_cc_live_chat_msg_sync&&t.on_cc_live_chat_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){p.chatMessageCache.refresh()},80)}}}function h(e){this.chatLogs=[],this.broadcasts=[],this.draws=[],this.pageChanges=[],this.isHistoryReady=!1,this.questions=[],this.answers=[],this.pageChanges=[],this.draws=[],this.animations=[],this.pageChangeIndex=-1,this.drawIndex=-1,this.animationIndex=-1,this.isRequestDraws=!1,this.drawPanel=new r(e,this),this.history=new c(e,this),this.chatMessageCache=new u,this.broadcastCache=new d}t.ListenerDuration=function(){if(on_cc_limit_request_draws){var e=setInterval(function(){parseInt(p.callbackPlayer.getDuration())&&(f.log(\"ListenerDuration\"),on_cc_limit_request_draws&&on_cc_limit_request_draws(),clearInterval(e))},50);t.ListenerDuration=null}},t.on_cc_limit_request_draws=function(){if(g.drawRequestTime){f.log(\"分页请求画笔数据\",g.drawRequestTime);var e=p.callbackPlayer.getDuration()+1;f.log(\"duration\",e+\"\");var a=Math.ceil(e/g.drawRequestTime),i={blockTime:a,startTime:0,endTime:0+a};p.state.init(i),f.log(\"callback.state\",p.state),p.drawsInfoRequestPool.httpRequestStream(function(e){p.draws=e,p.isHistoryReady=!0,p.drawPanel.isReady=!0}),setTimeout(function(){v()},1500),t.on_cc_limit_request_draws=null}},t.on_cc_request_snapshoot=function(e){if(g.drawRequestTime){f.log(\"pageChange\",e);var t=p.callbackPlayer.getPlayerTime();p.drawsInfoRequestPool.httpRequestSnapshoot(e,t,function(e){p.draws=e,p.isHistoryReady=!0,p.drawPanel.isReady=!0})}};var p={};t.debug=!1;var f={debug:t.debug,log:function(e,a){t.debug&&(a?console.log(e+\" => \",a):console.log(e))}};t.TIMEOUT=5e3;var g={userId:e(\"#userId\").val(),roomId:e(\"#roomId\").val(),liveId:e(\"#liveId\").val(),recordId:e(\"#recordId\").val(),videoId:e(\"#videoId\").val(),adapt:!1,isShowBar:0,viewerId:e(\"#viewerId\").val(),upId:e(\"#upId\").val(),viewer:{id:e(\"#viewerId\").val(),name:e(\"#viewerName\").val(),role:e(\"#viewerRole\").val(),sessionId:e(\"#sessionId\").val()},callbackPlayer:{id:\"playbackPlayer\",width:\"100%\",height:\"100%\"},drawPanel:{id:\"playbackPanel\",width:\"100%\",height:\"100%\"}},m={dpc:{},fastMode:!1,init:function(){this.dpc=new Dpc},appendDrawPanel:function(){var a='<iframe id=\"dpa\" allow-scripts allowfullscreen allowusermedia frameborder=\"0\" style=\"width: 100%;height:100%;\"></iframe>';\"isMobile\"==P.isMobile()&&(a='<iframe id=\"dpa\" allow-scripts allowfullscreen allowusermedia frameborder=\"0\" style=\"width: 100%;height:100%;pointer-events: none;\"></iframe>'),e(\"#playbackPanel\").parent().append(a),e(\"div#playbackPanel\").remove(),\"function\"==typeof t.on_cc_live_db_flip&&t.on_cc_live_db_flip()},pageChange:function(e){this.fastMode&&this.dpc.pageChange(e)},animationChange:function(e){this.fastMode&&this.dpc.animationChange(e)},history:function(e){this.fastMode&&this.dpc.history(e)},draw:function(e){this.fastMode&&this.dpc.draw(e)},clear:function(){this.fastMode&&this.dpc.clear()},docAdapt:function(e){if(this.fastMode){var t=e?\"1\":\"2\";this.dpc.setDisplayMode(t)}}},y={isH5play:!1,fastMode:!1,forceNew:!1,setFastMode:function(e){\"string\"==typeof e.fastMode?\"false\"===e.fastMode?this.fastMode=!1:this.fastMode=!0:\"boolean\"==typeof e.fastMode?this.fastMode=e.fastMode:this.fastMode=!1},config:function(t){(function(){if(a.createElement(\"video\").canPlayType){var e=a.createElement(\"video\");return oggTest=e.canPlayType('video/ogg; codecs=\"theora, vorbis\"'),oggTest?\"probably\"==oggTest:(h264Test=e.canPlayType('video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"'),!!h264Test&&\"probably\"==h264Test)}return!1})()&&(t.isH5play+\"\"==\"true\"?this.isH5play=!0:this.isH5play=!1),this.setFastMode(t),m.fastMode=this.fastMode;var i=[\"//static.csslcloud.net/js/socket.io.js\",\"//static.csslcloud.net/js/swfobject.js\",\"//image.csslcloud.net/js/dpc.js?v=20180121\",\"//static.csslcloud.net/js/json3.min.js\",\"//static.csslcloud.net/js/module/drawingBoard-2.0.0.js\",\"//static.csslcloud.net/js/module/drawingBoardPlayback.js\",\"//static.csslcloud.net/js/report.js\"];m.fastMode&&i.splice(3,2),this.loadScript(i,function(){!function(t){g.viewerId=t.viewerid,g=e.extend(g,t),p=new h(g)}(t),\"isMobile\"==P.isMobile()&&e.DrawingBoard&&!m.fastMode&&y.appendDrawPanel()}),\"boolean\"==typeof t.forceNew&&(this.forceNew=t.forceNew)},appendDrawPanel:function(){e(\"#playbackPanel\").parent().append('<canvas id=\"drawPanel\" width=\"1200\" height=\"1200\" style=\"position: absolute;z-index:2;top:0;left: 0\"></canvas><iframe id=\"dpa\" src=\"\" frameborder=\"0\" style=\"position: absolute;top:0;left: 0\"></iframe>'),e(\"div#playbackPanel\").remove()},logout:function(){e.ajax({url:\"//view.csslcloud.net/api/callback/logout\",type:\"GET\",dataType:\"json\",timeout:5e3,xhrFields:{withCredentials:!0},success:function(e){},error:function(e,t,a){}})},getScript:function(e,t){var i=!1,s=a.createElement(\"script\");s.src=e,s.onload=s.onreadystatechange=function(){i||this.readyState&&\"loaded\"!=this.readyState&&\"complete\"!=this.readyState||(i=!0,t&&t())},a.body.appendChild(s)},loadScript:function(e,t){if(\"string\"==typeof e){var a=e;(e=[]).push(a)}var i=this,s=function(e,t){i.getScript(e.shift(),function(){e.length?s(e,t):t&&t()})};s(e,t)},playbackRate:function(e){p.callbackPlayer.playbackRate(e)},seek:function(e){clearInterval(p.drawPanel.intervalNum),p.callbackPlayer.seek(e)},getPlayerTime:function(){return p.callbackPlayer.getPlayerTime()},getDuration:function(){return y.isH5play?P.getDuration():\"isMobile\"==P.isMobile()?P.getDuration():p.callbackPlayer.getDuration()},docAdapt:function(e){m.fastMode&&m.docAdapt(e),g.adapt=e},isShowBar:function(e){g.isShowBar=e},getBuffer:function(){return p.callbackPlayer.getBuffer()},setVolume:function(e){return p.callbackPlayer.setVolume(e)},getVolume:function(){return p.callbackPlayer.getVolume()},play:function(){return p.callbackPlayer.play()},setZScale:function(e){return p.callbackPlayer.setZScale(e)},getZScale:function(){return p.callbackPlayer.getZScale()},setScale:function(e){return p.callbackPlayer.setScale(e)},getScale:function(){return p.callbackPlayer.getScale()},openSettingPanel:function(){return p.callbackPlayer.openSettingPanel()}};function v(){p.isHistoryReady?function e(){p.callbackPlayer.isReady?p.drawPanel.intervalPainting(p):setTimeout(function(){e()},500)}():setTimeout(function(){v()},300)}e.extend({DW:y}),t.on_cc_callback_player=function(e){g.videoId=e.live.encryptRecordvideoId,g.recordId=e.encryptRecordId,p.callbackPlayer=new i(g)},t.on_cc_live_player_init=function(){p.callbackPlayer.isReady=!0;try{p.callbackPlayer.getFlash().start()}catch(e){}setInterval(function(){var e=0;try{e=p.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&p.chatLogs.length)for(var t=p.chatLogs[0];t.time<=e&&(t=p.chatLogs.shift(),p.chatMessageCache.push({userid:t.userId,username:t.userName,time:t.time,msg:t.content,groupId:t.groupId,chatId:t.chatId,status:t.status,useravatar:t.userAvatar,userRole:t.userRole,usercustommark:t.userCustomMark,role:t.role}),p.chatLogs.length);)t=p.chatLogs[0]},1e3),setInterval(function(){var e=0;try{e=p.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&p.broadcasts.length)for(var t=p.broadcasts[0];t.time<=e&&(t=p.broadcasts.shift(),p.broadcastCache.push({content:t.content,time:t.time}),p.broadcasts.length);)t=p.broadcasts[0]},1e3),\"function\"==typeof t.on_cc_live_player_load&&t.on_cc_live_player_load(),on_cc_limit_request_draws&&(parseInt(p.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},t.on_drampanel_ready=function(){p.drawPanel.isReady=!0,setTimeout(function(){v()},1500)},t.seekStart=function(){clearInterval(p.drawPanel.intervalNum)},t.seekComplete=function(){p.drawPanel.clear();var e=p.callbackPlayer.getPlayerTime();e<0&&(e=0),p.pageChangeIndex=-1,p.drawIndex=-1,p.animationIndex=-1;var a={pageChange:[],animation:[],draw:[]};if(p.pageChanges&&0<p.pageChanges.length){for(var i=0;i<p.pageChanges.length;i++)e>=(s=p.pageChanges[i]).time&&(p.pageChangeIndex=i);if(0<=p.pageChangeIndex){var s=p.pageChanges[p.pageChangeIndex];\"function\"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(s),\"function\"==typeof t.on_cc_request_snapshoot&&t.on_cc_request_snapshoot(s),p.drawPanel.filp(JSON.stringify({fileName:s.docName,totalPage:s.docTotalPage,docid:s.encryptDocId,url:s.url,page:s.pageNum,useSDK:s.useSDK})),a.pageChange.push(s)}}if(p.animations&&0<p.animations.length){for(i=0;i<p.animations.length;i++)e>=(n=p.animations[i]).time&&(p.animationIndex=i);if(0<=p.animationIndex){var r=p.pageChangeIndex;if(0<=r){s=p.pageChanges[r];var n=p.animations[p.animationIndex];s&&n&&s.encryptDocId==n.encryptDocId&&e>=n.time&&s.time<=n.time&&(p.drawPanel.animation(JSON.stringify({fileName:n.docName,totalPage:n.docTotalPage,docid:n.encryptDocId,url:n.url,page:n.pageNum,step:n.step})),a.animation.push(n))}}}if(p.draws&&0<p.draws.length){for(i=0;i<p.draws.length;i++)(c=p.draws[i])&&e>=c.time&&(p.drawIndex=i);var o=p.draws.slice(0,p.drawIndex+1);if(0<o.length){var l=[];for(i=0;i<o.length;i++){var c=o[i];l.push(c.data),a.draw.push(c)}p.drawPanel.draws(l)}}m.history(a),p.drawPanel.intervalNum=setInterval(function(){p.drawPanel.interval()},1e3)};var w={addEvents:function(e,t,i){a.addEventListener?w.addEvents=function(e,t,a){e.addEventListener(t,a,!1)}:w.addEvents=function(e,t,a){e.attachEvent(\"on\"+t,function(){a.call(e,arguments)})},w.addEvents(e,t,i)}},_=0,I=0,b=!0,P={pauseState:!1,init:function(a){var i=this;e.ajax({url:\"//view.csslcloud.net/api/vod/v2/play/h5\",type:\"GET\",dataType:\"jsonp\",data:{userid:a.userId,roomid:a.roomId,recordid:a.recordId},success:function(e){var s=e.video[0],r=s.playurl,n=s.secureplayurl;\"https:\"===t.location.protocol&&n&&(r=n),i.appendVideo(r,a)}})},appendVideo:function(i,s){var r=this,n='<video id=\"playbackVideo\" webkit-playsinline playsinline controls autoplay x-webkit-airplay=\"deny\" x5-playsinline width=\"100%\" height=\"100%\" src=\"'+i+'\"></video>';e(\"#\"+playbackPlayer.id).html(n);var o=a.getElementById(\"playbackVideo\");s.isShowBar&&o.removeAttribute(\"controls\");var l=0,c=1;\"isMobile\"==P.isMobile()&&(l=1,c=11),new ReportLog(s,l,c,o,!1),this.isAndroid()||(this.pauseState=!0),w.addEvents(o,\"canplay\",function(){\"isMobile\"==P.isMobile()?(t.on_cc_live_player_load&&t.on_cc_live_player_load(),t.on_cc_h5_player_load&&t.on_cc_h5_player_load()):y.isH5play&&t.on_cc_live_player_init&&t.on_cc_live_player_init(),on_cc_limit_request_draws&&(parseInt(p.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},!1),w.addEvents(o,\"playing\",function(){r.pauseState=!1,t.on_player_start&&on_player_start(),t.on_spark_player_resume&&on_spark_player_resume()},!1),w.addEvents(o,\"pause\",function(){r.pauseState=!0,t.on_spark_player_pause&&on_spark_player_pause()},!1),w.addEvents(o,\"ended\",function(){t.on_spark_player_end&&on_spark_player_end()},!1),w.addEvents(o,\"seeking\",function(){b=!1,seekStart&&seekStart()},!1),w.addEvents(o,\"seeked\",function(){b=!1,seekComplete&&seekComplete()},!1)},getDuration:function(){var e=a.getElementById(\"playbackVideo\");if(e)return Math.floor(e.duration)},getPlayerTime:function(){var e=a.getElementById(\"playbackVideo\");if(e)return Math.floor(e.currentTime)},end:function(){e(\"#\"+playbackPlayer.id).html(\"end\")},appendDoc:function(t){var a='<img src=\"'+t+'\" />';e(\"#\"+playbackPanel.id).append(a)},isMobile:function(){if(this.isIPad()||this.isIPhone()||this.isAndroid()||this.isWindowsPhone())return\"isMobile\"},isIPad:function(){return null!=navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!=navigator.userAgent.match(/iPhone/i)},isAndroid:function(){return null!=navigator.userAgent.match(/Android/i)},isWindowsPhone:function(){return null!=navigator.userAgent.match(/Windows Phone/i)}}}(jQuery,window,document)}]);","extractedComments":[]}