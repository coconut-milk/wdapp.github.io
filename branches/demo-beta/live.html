<!doctype html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <title>PC端观看直播</title>
    <link rel="stylesheet" href="css/liveVersionOne/fatstyle.css">
    <link rel="stylesheet" href="css/liveVersionOne/video-main.css">
    <link rel="stylesheet" href="css/liveVersionOne/pop.css">
    <style>
        #mask{width: 100%; height: 100%; background: #ccc; position: absolute; top: 0; left: 0; z-index: 100; display: none; opacity: 0.8;}
        #mask img{max-width: 50%; max-height: 70%; cursor: pointer; position: absolute; top:0; bottom:0; left:0; right:0; margin:auto; z-index: 1001}
        #mask p{display: block; position: fixed; top: 100px; right: 150px; font-size: 30px; cursor: pointer}

    </style>
</head>
<body>
<h1 class="main-title">直播间</h1>
<!-- left start -->
<div class="video-left">
    <div id="left-bar" class="left-bar">
        <span id="left-switch" class="bar-switch left-icons"></span>
    </div>
    <div id="widget-video" class="widget-video">
        <div id="main-video" class="main-video">
            <div id="videoInteractions"></div>
            <div id="audioInteractions" style="display: none;"></div>
            <div class="call-box call-box-small" id="videoInteraction" style="display: none;">
                <div class="call-tit">视频通话申请中...</div>
                <div class="btn-toggle"></div>
                <video id="interactionLocalVideo" style="height: 100%; width: 100%;" autoplay></video>
            </div>

            <!-- 直播视频模块 -->
            <div id="livePlayer"></div>
        </div>
        <div id="video-tools" class="video-tools">
            <a href="javascript:;" id="full-video" class="btn-full"> </a>
        </div>
    </div>
    <div id="question" class="question">
        <div class="question-title">
            <h2><i></i><span>提问区</span></h2>
        </div>
        <div class="question-main live-left">
            <ul id="question-main" class="l-b-m-list">

            </ul>
        </div>
        <div class="question-user">
            <div class="llb-t">
                <div class="face"></div>
                <div class="o-t" id="only-me"><i></i>只看我的提问</div>
            </div>
            <div class="llb-b">
                <div class="chat-send-content" id="question-content" contenteditable="true"></div>
                <a href="javascript:;" class="btn btn-mini btn-chat" id="question-submit">发送</a>
            </div>
        </div>
    </div>
</div>
<!-- left end -->
<!-- middle start -->
<div class="video-middle" id="video-middle">
    <div class="video-m-top" id="doc-main" data-module="1">
        <div class="document-main">

            <!-- 直播文档模块 -->
            <div id="drawPanel"></div>

        </div>
        <div id="ppt-tools" class="ppt-tools">
            <a href="javascript:;" id="full-ppt" class="btn-full"> </a>
        </div>
    </div>


    <div class="l-m-b">
        <div class="lmb-r">
            <ul class="lmb-r-tools">
                <li><a href="javascript:;" class="wl" id="btn-network" title="切换线路"></a></li>
                <li><a href="javascript:;" class="qh" id="btn-switch" title="切换窗口"></a></li>
                <li><a href="javascript:;" class="only-audio" id="btn-audio" title="只听音频"></a></li>
                <li title="视频互动" name="interaction" t="video" style="display: none;">
                    <a href="javascript:void(0);" class="video" data-title="视频互动"></a>
                </li>
                <li title="语音互动" name="interaction" t="audio" style="display: none;">
                    <a href="javascript:void(0);" class="audio" data-title="语音互动"></a>
                </li>
                <li>
                    <a href="javascript:;" class="gm" id="change-nickname" title="改名"></a>
                </li>
                <li  style="display: none;">
                    <a href="javascript:;" class="gm" id="changeMode" title="自由模式"></a>
                </li>
                <li style="width: 100px; display: none;">
                    <input type="text" id="docId" placeholder="输入文档id">
                </li>
                <li style="width: 100px; display: none;"><input  id="pageIndeId" type="text" placeholder="输入页码"></li>
                <li style="width: 100px; display: none;"><input  id="jump_btn" type="button" value="跳转"></li>
                <li style="width: 100px; margin-left: 450px;">
                    <span class="fl mr5" style="float: left;" id="mr5"></span>
                    <a title="退出登录" href="javascript:void(0);" id="logout" class="exit" data-title="退出" style="display: block;"></a>
                </li>
                <span id="interactionMsg" style="padding-top: 5px; display: inline-block;"  style="display: none;"></span>
            </ul>
        </div>
    </div>


</div>
<!-- middle end -->
<!-- right start -->
<div class="video-right live-right" id="video-right">
    <div id="right-bar" class="right-bar">
        <span id="right-switch" class="bar-switch right-icons"></span>
    </div>
    <div class="chat-main">
        <div class="chat-title">
            <h2><i></i><span>公共聊天区</span></h2>
            <div class="chat-people" id="chat-people"></div>
            <div class="userlist" id="list-main">
                <i class="curr"></i>
                <h3 class="h6">在线用户(<em id="people-number"></em>)</h3>
                <ul id="people-list">
                </ul>
            </div>
        </div>
        <div class="chat-list l-r-m">
            <ul id="chat-list" class="chat-list l-r-m-list">
            </ul>
        </div>
        <div class="chat-send">
            <div class="chat-tips-scroll" id="chat-tips-scroll">有<em>0</em>条未读记录。</div>
            <div class="chat-tools">

                <div class="lrb-t">
                    <div class="face" id="btn-face"></div>
                    <div class="o-t" id="isPrivateChat">
                        对
                        <span class="select-span">
                                <span class="select-current" id="all">所有人</span>
                                <em class="p-arrow"></em>
                            </span>
                        <ul id="private-name">
                            <li id="all">所有人</li>
                        </ul>
                        说:
                    </div>
                </div>
            </div>
            <div class="chat-area">
                <div class="chat-tips" id="chat-tips">
                    <span class="arr"></span>
                    <a href="javascript:;" class="tips-main">您现在感觉卡了吗？点这里</a>
                    <a href="javascript:;" class="close-tips" id="close-tips">关闭提示</a>
                </div>
                <div class="lrb-b">
                    <input class="chat-send-content" contenteditable="true" id="chat-content">
                    <a href="javascript:;" class="btn btn-mini btn-chat" id="chat-submit">发送</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 选择网络 -->
<div class="public-layer" id="network">
    <div class="layer-title">
        <h2>选择网络</h2>
        <span class="layer-close" id="work-close"></span>
    </div>
    <div class="layer-content">
        <p>以下可以选择的网络途径:</p>
        <ul class="change-network" id="change-network">
            <li><input type="radio" value="0" name="network" id="network0" checked=""><label for="network0">主线路</label>
            </li>
            <li><input type="radio" value="1" name="network" id="network1"><label for="network1">备用线路</label></li>
        </ul>
        <div class="networks btns">
            <input type="button" class="works-btn" id="btn-netsubmit" value="确定">
            <input type="button" class="works-btn" id="btn-netcannel" value="取消">
        </div>
    </div>
</div>

<!-- 输入提示 -->
<div class="input-tips" id="input-tips">
    <i></i>
    <p></p>
    <div class="input-tips-cur"></div>
</div>

<!-- 签到 -->
<div class="sign">
    <div class="siandiv">
        <div class="signline"></div>
        <div class="signicon"></div>
        <div class="signtxt"></div>
        <div class="signbtn">
            <button>我要签到</button>
        </div>
    </div>
    <div class="maskbg"></div>
</div>

<!-- 抽奖 -->
<div class="lottery">
    <div class="lotterydiv">
        <div class="lotteryh3">正在抽奖</div>
        <div class="lotteryclose"></div>
        <div class="lotterynum"></div>
        <div class="lotterytext">请牢记您的中奖码</div>
        <div class="lotterybox">
            <div class="lotterytext2">中奖者</div>
            <div class="lotteryname"></div>
        </div>
    </div>
    <div class="maskbg"></div>
</div>

<!-- 答题 -->
<div class="vote">
    <div class="votediv">
        <div class="vote-line"></div>
        <div class="vote-close"></div>
        <div id="vote1">
            <div class="vote-icon"></div>
            <h3>请选择答案</h3>
            <div class="vote-tips">题干部分请参考文档或直播视频</div>
            <ul class="vote-option">
            </ul>
        </div>
        <div id="vote2">
            <div class="vote-icon2"></div>
            <h3>答题统计</h3>
            <div class="vote-tips">答题结束，共<span id="vote-count"></span>人回答。</div>
            <div class="vote-a">
                <span id="yansw">您的答案:<em></em></span>
                <span id="cansw" class="vote-righta">正确答案:<em></em></span>
            </div>
            <ul class="vote-list">
            </ul>
        </div>
    </div>
    <div class="maskbg"></div>
</div>
<span id="viewerMarquee" style="display: none">
    {"loop":-1,"type":"text","text":{"content":"123","font_size":20,"color":"0xffffff"},"action":[{"duration":4000,"start":{"xpos":0.3,"ypos":0,"alpha":0.5},"end":{"xpos":0,"ypos":0.4,"alpha":0.5}},{"duration":16000,"start":{"xpos":0,"ypos":0.4,"alpha":0.5},"end":{"xpos":0.8,"ypos":1,"alpha":0.5}},{"duration":4000,"start":{"xpos":0.8,"ypos":1,"alpha":0.5},"end":{"xpos":1,"ypos":0.8,"alpha":0.5}},{"duration":16000,"start":{"xpos":1,"ypos":0.8,"alpha":0.5},"end":{"xpos":0,"ypos":0.2,"alpha":0.5}},{"duration":4000,"start":{"xpos":0,"ypos":0.2,"alpha":0.5},"end":{"xpos":0.2,"ypos":0,"alpha":0.5}},{"duration":12000,"start":{"xpos":0.2,"ypos":0,"alpha":0.5},"end":{"xpos":1,"ypos":0.6,"alpha":0.5}},{"duration":8000,"start":{"xpos":1,"ypos":0.6,"alpha":0.5},"end":{"xpos":0.4,"ypos":1,"alpha":0.5}},{"duration":8000,"start":{"xpos":0.4,"ypos":1,"alpha":0.5},"end":{"xpos":0,"ypos":0.7,"alpha":0.5}},{"duration":16000,"start":{"xpos":0,"ypos":0.7,"alpha":0.5},"end":{"xpos":1,"ypos":0.3,"alpha":0.5}},{"duration":8000,"start":{"xpos":1,"ypos":0.3,"alpha":0.5},"end":{"xpos":0.3,"ypos":0,"alpha":0.5}}]}
</span>


<!--蒙板-->
<div id="mask">
    <p>x</p>
    <img src=""/>
</div>




<!--<input type="hidden" value="1" id="documentDisplayMode">-->
<script src="js/jquery-1.9.0.min.js"></script>
<script src="js/handlebars.js"></script>
<script src="js/base.js"></script>
<script src="js/common.js"></script>
<script src="//view.csslcloud.net/js/liveSDK.js?v=201903271101" type="text/javascript"></script>
<script src="js/live.js"></script>
<script src="js/cc.questionnaire.js"></script>
<script src="js/ui.js"></script>
<script src="AgoraRTCSDK-2.8.0.js"></script>


<div id="test" style="top:0;right:0;position: absolute;z-index: 9999;width: 1400px;height: 800px;background-color: green">

    <div id="div_device" class="panel panel-default">
        <div class="select">
            <label for="audioSource">Audio source: </label><select id="audioSource"></select>
        </div>
        <div class="select">
            <label for="videoSource">Video source: </label><select id="videoSource"></select>
        </div>
    </div>

    <div id="div_join" class="panel panel-default">
        <div class="panel-body">
            App ID: <input id="appId" type="text" value="95c5a17fde93477ca78a3a7e917fd29a" size="36"></input>
            token: <input id="token" type="text"
                          value="00695c5a17fde93477ca78a3a7e917fd29aIAB62xjT6R/KlwzaXtGNtrmDhjOIp9+dRepZ5R7OYacAdhejJ7QAAAAAEACsokrt71Y5XQEAAQDvVjld">
            Channel: <input id="channel" type="text" value="1000" size="4"></input>
            Host: <input id="video" type="checkbox" checked></input>
            <button id="join" class="btn btn-primary" onclick="join()">Join</button>
            <button id="leave" class="btn btn-primary" onclick="leave()">Leave</button>
            <button id="publish" class="btn btn-primary" onclick="publish()">Publish</button>
            <button id="unpublish" class="btn btn-primary" onclick="unpublish()">Unpublish</button>
        </div>
    </div>

    <!--style>
    .video__box{width:910px; margin:0 auto; overflow:hidden;}
    .video__main{ width:810px; height:607px;float:left }
    .video__list{ width:200px; height:607px; float:left;}
    .video__item{ width:200px; height:174px; hei background:url(/img/icon_live.png) center center no-repeat; }
    </style>
    <div class="video__main">
    </div>
    <div class="video__list">
        <div class="video__item"></div>
        <div id="video" class="video__item">
            <div id="agora_local"></div>
        </div>
    </div-->

    <div id="video" style="margin:0 auto;">
        <div id="agora_local" style="float:right;width:210px;height:147px;display:inline-block;"></div>
    </div>


</div>

<script language="javascript">

  if (!AgoraRTC.checkSystemRequirements()) {
    alert('Your browser does not support WebRTC!')
  }

  /* select Log type */
  // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.NONE);
  // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.ERROR);
  // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.WARNING);
  // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.INFO);
  // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.DEBUG);

  /* simulated data to proof setLogLevel() */
  AgoraRTC.Logger.error('this is error')
  AgoraRTC.Logger.warning('this is warning')
  AgoraRTC.Logger.info('this is info')
  AgoraRTC.Logger.debug('this is debug')

  var client, localStream, camera, microphone

  var audioSelect = document.querySelector('select#audioSource')
  var videoSelect = document.querySelector('select#videoSource')

  function join () {
    document.getElementById('join').disabled = true
    document.getElementById('video').disabled = true
    var channel_key = document.getElementById('token').value
    console.log('channel_key', channel_key)
    console.log('Init AgoraRTC client with App ID: ' + appId.value)
    client = AgoraRTC.createClient({mode: 'live'})
    client.init(appId.value, function () {
      console.log('AgoraRTC client initialized')
      client.join(channel_key, channel.value, null, function (uid) {
        console.log('User ' + uid + ' join channel successfully')

        if (document.getElementById('video').checked) {
          camera = videoSource.value
          microphone = audioSource.value
          localStream = AgoraRTC.createStream({
            streamID: uid,
            audio: true,
            cameraId: camera,
            microphoneId: microphone,
            video: document.getElementById('video').checked,
            screen: false
          })
          //localStream = AgoraRTC.createStream({streamID: uid, audio: false, cameraId: camera, microphoneId: microphone, video: false, screen: true, extensionId: 'minllpmhdgpndnkomcoccfekfegnlikg'});
          if (document.getElementById('video').checked) {
            localStream.setVideoProfile('720p_3')

          }

          // The user has granted access to the camera and mic.
          localStream.on('accessAllowed', function () {
            console.log('accessAllowed')
          })

          // The user has denied access to the camera and mic.
          localStream.on('accessDenied', function () {
            console.log('accessDenied')
          })

          localStream.init(function () {
            console.log('getUserMedia successfully')
            localStream.play('agora_local')

            client.publish(localStream, function (err) {
              console.log('Publish local stream error: ' + err)
            })

            client.on('stream-published', function (evt) {
              console.log('Publish local stream successfully')
            })
          }, function (err) {
            console.log('getUserMedia failed', err)
          })
        }
      }, function (err) {
        console.log('Join channel failed', err)
      })
    }, function (err) {
      console.log('AgoraRTC client init failed', err)
    })

    channelKey = ''
    client.on('error', function (err) {
      console.log('Got error msg:', err.reason)
      if (err.reason === 'DYNAMIC_KEY_TIMEOUT') {
        client.renewChannelKey(channelKey, function () {
          console.log('Renew channel key successfully')
        }, function (err) {
          console.log('Renew channel key failed: ', err)
        })
      }
    })


    client.on('stream-added', function (evt) {
      var stream = evt.stream
      console.log('New stream added: ' + stream.getId())
      console.log('Subscribe ', stream)
      client.subscribe(stream, function (err) {
        console.log('Subscribe stream failed', err)
      })
    })

    client.on('stream-subscribed', function (evt) {
      var stream = evt.stream
      console.log('Subscribe remote stream successfully: ' + stream.getId())
      if ($('div#video #agora_remote' + stream.getId()).length === 0) {
        $('div#video').append('<div id="agora_remote' + stream.getId() + '" style="float:left; width:810px;height:607px;display:inline-block;"></div>')
      }
      stream.play('agora_remote' + stream.getId())
    })

    client.on('stream-removed', function (evt) {
      var stream = evt.stream
      stream.stop()
      $('#agora_remote' + stream.getId()).remove()
      console.log('Remote stream is removed ' + stream.getId())
    })

    client.on('peer-leave', function (evt) {
      var stream = evt.stream
      if (stream) {
        stream.stop()
        $('#agora_remote' + stream.getId()).remove()
        console.log(evt.uid + ' leaved from this channel')
      }
    })
  }

  function leave () {
    document.getElementById('leave').disabled = true
    client.leave(function () {
      console.log('Leavel channel successfully')
    }, function (err) {
      console.log('Leave channel failed')
    })
  }

  function publish () {
    document.getElementById('publish').disabled = true
    document.getElementById('unpublish').disabled = false
    client.publish(localStream, function (err) {
      console.log('Publish local stream error: ' + err)
    })
  }

  function unpublish () {
    document.getElementById('publish').disabled = false
    document.getElementById('unpublish').disabled = true
    client.unpublish(localStream, function (err) {
      console.log('Unpublish local stream failed' + err)
    })
  }

  function getDevices () {
    AgoraRTC.getDevices(function (devices) {
      for (var i = 0; i !== devices.length; ++i) {
        var device = devices[i]
        var option = document.createElement('option')
        option.value = device.deviceId
        if (device.kind === 'audioinput') {
          option.text = device.label || 'microphone ' + (audioSelect.length + 1)
          audioSelect.appendChild(option)
        } else if (device.kind === 'videoinput') {
          option.text = device.label || 'camera ' + (videoSelect.length + 1)
          videoSelect.appendChild(option)
        } else {
          console.log('Some other kind of source/device: ', device)
        }
      }
    })
  }

  //audioSelect.onchange = getDevices;
  //videoSelect.onchange = getDevices;
  getDevices()
</script>

<script type="text/javascript">
    // 直播SDK参数配置
    DWLive.init({
        userid: localStorage.userid,
        roomid: localStorage.roomid,
        groupid: localStorage.groupid,
        viewername: localStorage.viewername,
        viewertoken: localStorage.viewertoken,
        viewercustomua: 'web',
        language: 'en',
        viewercustominfo: '',
        fastMode: localStorage.fastmode,
        forceNew: localStorage.forceNew === 'true' ? true : false
    });

    DWLive.onLoginError = function(){
        console.log('登录失败')
    };

    DWLive.onLiveTime = function (e) {
        console.log('onLiveTime', e);
    };

    var marquee;
    DWLive.getMarquee = function (data) {
        console.log(data);
        if(!!data){
            marquee = data;
            return;
        }
        marquee =$('#viewerMarquee').text();
    };

    window.on_cc_swf_loading_completed = function () {
        setTimeout(function () {
            var marqueeInfo=$.trim(marquee);
            if(!isMainVideo){
                DWLive.showMarqueeDoc(marquee);
            }else{
                DWLive.showMarquee(marquee);
            }

        }, 1000);
    };
    window.switch_main_show_marquee = function () {
        if(!isMainVideo){
            DWLive.closeMarquee();
            DWLive.showMarqueeDoc(marquee);
        }else{
            DWLive.closeMarqueeDoc();
            DWLive.showMarquee(marquee);
        }
    };
    DWLive.onLoginSuccess =function (data) {
        DWLive.docAdapt(true);
        DWLive.groupId = data.viewer.groupId;
    };
    //动态显示登陆名
    window.onload = function () {
        $('#mr5').html(localStorage.viewername);
    }

    DWLive.onSilenceUserChatMessage = function(da){

    }

    DWLive.onSwitchVideoDoc= function(main){
        console.log('当前是否以视频为主-->' + main);
    }
</script>

</body>
</html>